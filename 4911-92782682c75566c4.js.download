!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ece3d12c-f0bd-40fa-90e1-b49f6386149e",e._sentryDebugIdIdentifier="sentry-dbid-ece3d12c-f0bd-40fa-90e1-b49f6386149e")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"4f7a062e"};"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4911],{317:(e,t,r)=>{r.d(t,{u9:()=>p,Pz:()=>d});var n=r(29935),a=r(82643),o=r(53847),i=function(e){var t=e.dbName,r=e.version,i=e.onUpgrade;return(0,n._)(function(){return(0,a.YH)(this,function(e){return[2,new Promise(function(e,n){var a=indexedDB.open(t,r);a.onerror=function(){var e;return n(Error("Failed to open database: ".concat(null==(e=a.error)?void 0:e.message)))},a.onsuccess=function(){return e(a.result)},i&&(a.onupgradeneeded=function(e){var t=e.target;(0,o._)(t,IDBOpenDBRequest)&&t.result?i(t.result):n(Error("Invalid target during upgrade."))})})]})})()},s=function(e){var t=e.db,r=e.storeName,o=e.mode,i=e.operation;return(0,n._)(function(){return(0,a.YH)(this,function(e){return[2,new Promise(function(e,n){if(!t.objectStoreNames.contains(r))return n(Error('Object store "'.concat(r,'" does not exist in the database.')));var a=t.transaction([r],o),s=i(a.objectStore(r));s.onsuccess=function(){return e(s.result)},s.onerror=function(){var e;return n(Error("Transaction error: ".concat(null==(e=s.error)?void 0:e.message)))},a.onabort=function(){return n(Error("Transaction was aborted."))},a.onerror=function(){return n(Error("Transaction encountered an error."))}})]})})()},c="LandingPageAgentAttachments",u=null,l=function(){return(0,n._)(function(){return(0,a.YH)(this,function(e){return u?[2,u]:[2,u=i({dbName:"ReplitAgentAttachments",version:1,onUpgrade:function(e){e.objectStoreNames.contains(c)||e.createObjectStore(c,{keyPath:"id",autoIncrement:!0})}})]})})()},d=function(){return(0,n._)(function(){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,l()];case 1:var t;return[2,s({db:(t={db:e.sent(),storeName:c}).db,storeName:t.storeName,mode:"readonly",operation:function(e){return e.getAll()}})]}})})()},p=function(){return(0,n._)(function(){return(0,a.YH)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,n._)(function(){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,l()];case 1:var t;return[2,s({db:(t={db:e.sent(),storeName:c}).db,storeName:t.storeName,mode:"readwrite",operation:function(e){return e.clear()}})]}})})()];case 1:return e.sent(),[3,3];case 2:return e.sent(),[2];case 3:return[2]}})})()}},24911:(e,t,r)=>{r.d(t,{M:()=>Z});var n=r(29935),a=r(53847),o=r(17844),i=r(93629),s=r(12694),c=r(82643),u=r(40185),l=r(21462),d=r(10795),p=r(12584),f=r(41114),m=r(39590),g=r(54744),h=r(6876),v=r(41991);function _(){var e=(0,p._)(["\n  mutation CreateAgentReplCreateRepl($input: CreateReplInput!) {\n    createRepl(input: $input, isTitleAutoGenerated: false) {\n      ... on Repl {\n        id\n        ...ReplLinkRepl\n        ...CrosisContextRepl\n      }\n      ... on UserError {\n        message\n      }\n    }\n  }\n  ","\n  ","\n"]);return _=function(){return e},e}function y(){var e=(0,p._)(["\n  query CreateAgentReplCurrentUser {\n    currentUser {\n      id\n      username\n      ...CrosisContextCurrentUser\n      replCount {\n        ... on ReplCount {\n          count\n        }\n      }\n    }\n  }\n  ","\n"]);return y=function(){return e},e}var b={},E=(0,f.J1)(_(),h.r,v.c),I=(0,f.J1)(y(),v.N),S=r(86035),T=r(89742),A=r(90629);function w(){var e=(0,p._)(["\n  mutation GenerateAgentReplIcon($prompt: String!, $replId: String!) {\n    generateReplIcon(input: { prompt: $prompt, replId: $replId }) {\n      ... on GenerateReplIconResult {\n        repl {\n          id\n          iconUrl\n        }\n      }\n    }\n  }\n"]);return w=function(){return e},e}var R={},C=(0,f.J1)(w()),P=r(89961),k=r(74248),N=r(97598),U=r(86402),O=r(30284),F=r(86103),L=r(47737),M=r(34778),x=r(13927),D=r(35897),B=r(317),G=r(55494),Y=r(26279),q=r(99344),j=r(71696),H=r(90352),V=r(78624),$=r(53178),z=r(33868),J=r(41426),K=r(14385);function Z(e){var t,r,p,f,h,v,_,y,w,Z,W,Q,X,ee,et,er,en,ea,eo=e.currentUser,ei=(0,s._)((0,l.useState)("idle"),2),es=ei[0],ec=ei[1],eu=(0,Y.pE)("folderId","string"),el=(0,L.m6)(),ed=(0,D.A)().showError,ep=(0,s._)((v=(0,o._)({},b,void 0),m.n(E,v)),1)[0],ef=(p=(r=(t=(0,o._)({},b,void 0),g.I(I,t))).data,f=r.error,h=r.loading,f?{loading:!1,currentUser:null,errorCode:500}:(null==p?void 0:p.currentUser)?{loading:!1,currentUser:p.currentUser,errorCode:null}:h?{loading:!0,currentUser:null,errorCode:null}:{loading:!1,currentUser:null,errorCode:403}).currentUser,em=(0,V.L)(),eg=(0,u.useRouter)(),eh=(0,q.A)(),ev=(0,F._P)({controlName:"flag-killswitch-agent"}),e_=(0,F._P)({controlName:"flag-agent-onboarding-ws"}),ey=function(e){ec("idle"),ed(e.message),(0,T.B)(e)},eb=(0,s._)((0,l.useState)("disconnected"),2),eE=eb[0],eI=eb[1],eS=(y=(_={currentUserUsername:eo.username,currentUserEmail:eo.email,currentUserTimeCreated:eo.timeCreated,updatePromptConnectionStatus:function(e){eI(e)}}).currentUserUsername,w=_.currentUserEmail,Z=_.currentUserTimeCreated,W=_.updatePromptConnectionStatus,Q=(0,F._P)({controlName:"flag-repl-creation-slack-bot-events"}),X=(0,F._P)({controlName:"flag-explore-tool-type",type:"string",default:"None"}),ee=(0,F._P)({controlName:"flag-agent-image-gen-awareness",default:!1}),et=(0,L.m6)(),function(e){return(0,n._)(function(e){var t,r,a,i,s,u,l,d,p,f,m,g,h,v,_,b,E,I,T;return(0,c.YH)(this,function(A){switch(A.label){case 0:return t=e.prompt,r=e.uploadedFiles,a=e.requestedStackBlueprint,i=e.agentStackTriggerType,s=e.replId,u=e.currentUserId,l=e.orgId,d=e.customStackReplId,p=e.themeConfig,f=e.initialBuildMode,m=e.agentChatMode,g=e.agentStackPlatformType,h=(0,P.hV)({currentUserId:u}),(v=new P.Zn({clientId:h,serverId:U.wV,connectImmediately:!0,getEndpoint:function(){return(0,n._)(function(){var e,t;return(0,c.YH)(this,function(r){switch(r.label){case 0:return[4,(0,U.j2)(s,h,l)];case 1:return e=r.sent(),(t=new URL((0,U.qK)())).searchParams.set("auth_token",e),[2,t]}})})()},onProtocolError:function(e){throw Error("Failed to send agent prompt. Protocol error: ".concat(e.message))},onRetriesExceeded:function(){throw Error("Unable to connect. Please try again later.")}})).status.subscribe(function(e){W(e)}),_=(0,k.uc)({sessionType:S.dF3.AGENT_SESSION,replId:s}),[4,v.service.createSession.rpc(_)];case 1:if(!(b=A.sent()).ok)throw Error("Failed to send agent prompt. Session creation failed.");return E=b.payload.sessionId,I=b.payload.sessionCreationEventId,T=(0,N.k)({session:E,parent:I,model:S.e3q.ADVANCED,sender:{id:u,membership:S.VMq.CORE,timeCreated:new Date(Z)},addToChild:!1,data:{kind:"message",message:t,uploadedFiles:r,requestedStackBlueprint:a,agentStackTriggerType:i,intent:S.qRv.AGENT,customStackReplId:d,themeConfig:p,agentConfig:{webSearchEnabled:"None"!==X,enableAutomatedTesting:!1,imageGenerationEnabled:ee,initialBuildMode:f,chatMode:m}}}),v.service.createEvent.rpc(T.request),(0,M.u4)(O.AZ.START_WITH_AI_USED,(0,o._)({action:"created_agent_session",prompt:t,attachments:r,repl_id:s,username:y,email:w,is_mobile:et,has_agent:!0,send_to_slack_bot:Q,session_id:E,langsmith_url:(0,U.Yd)(E,S.dF3.AGENT_SESSION)},g&&{agentStackPlatformType:g})),(0,x.pI)({action:"created_new_session",sessionId:E}),[2]}})}).apply(this,arguments)}),eT=(ea=(0,s._)((er={onError:function(e){A.Cp(e)}},en=(0,o._)({},R,er),m.n(C,en)),1)[0],function(e){var t=e.prompt,r=e.attachments,n=e.replId;ea({variables:{prompt:t+(r.length>0?"\n\nWith attachments: ".concat(r.map(function(e){return e.path}).join(", ")):""),replId:n}})}),eA=function(e){switch(e){case d.J_c.Slack:return S.ezV.SLACK_MESSAGE;case d.J_c.Telegram:return S.ezV.TELEGRAM_MESSAGE;case d.J_c.TimeBased:return S.ezV.TIME_BASED;default:return}};return{createAgentRepl:function(e){return(0,n._)(function(e){var t,r,s,u,l,d,p,f,m,g,h,v,_,y,b,E,I,T,A,w,R,C;return(0,c.YH)(this,function(P){switch(P.label){case 0:if(t=e.prompt,r=e.attachments,s=e.requestedStackBlueprint,u=e.isPrivate,l=e.teamId,d=e.orgId,p=e.customStackReplId,f=e.isExpertMode,m=e.themeConfig,g=e.initialBuildMode,h=e.appThemeId,v=e.agentStackPlatformType,ev)return ed("This feature is currently unavailable."),ec("idle"),[2];return(0,G.O7)(),[4,(0,B.u9)()];case 1:return P.sent(),ec("creating_repl"),_=!p&&!f,y=s===S.qf8.STACK_BLUEPRINT_AGENT,[4,ep({variables:{input:{aiPromptText:t,aiPromptAttachmentPaths:r.map(function(e){return e.path}),folderId:eu,isPrivate:u,teamId:l,orgId:d,originId:p,detachFromProject:!!p,isInPlanningPhase:_,isExpertMode:f,isAgentStack:y,agentStackPlatformType:v}}})];case 2:if((b=P.sent()).errors)return ey(Error(b.errors.map(function(e){return e.message}).join(", "))),[2];if(!b.data)return ey(Error("Expected data from createRepl graphql mutation")),[2];if("message"in b.data.createRepl)return ey(Error(b.data.createRepl.message)),[2];if(E=b.data.createRepl,eT({prompt:t,attachments:r,replId:E.id}),!(I=r&&r.length>0))return[3,4];return T=(0,H.O)({repl:E,currentUser:ef}),(A=(0,j.Ay)({onUnrecoverableError:function(e){ec("idle"),ed(e.message)}})).connect({context:T,getMinimumRetryDelayMs:em}),ec("configuring_repl"),[4,function(e){return(0,n._)(function(e){var t,r,n,a,o;return(0,c.YH)(this,function(i){switch(i.label){case 0:if(t=e.hasAttachments,r=e.container,n=e.attachments,a=e.handleError,!t)return[2];return o=(0,$.A)({container:r}),[4,(0,z.Zn)({parentPath:J.Ls,files:n.map(function(e){return e.file}),fs:o,onError:function(e){a(Error("Error uploading ".concat(e.path,": ").concat(e.error)))}})];case 1:return i.sent(),[2]}})}).apply(this,arguments)}({hasAttachments:I,attachments:r,container:A,handleError:ey})];case 3:P.sent(),P.label=4;case 4:return P.trys.push([4,6,,7]),[4,eS({prompt:t,uploadedFiles:r.map(function(e){return{path:e.path,mimeType:e.file.type}}),requestedStackBlueprint:s,agentStackTriggerType:eA(v),replId:E.id,currentUserId:eo.id,orgId:d,customStackReplId:p,themeConfig:m,initialBuildMode:g,agentChatMode:_&&!f?S.xyI.AGENT_MODE_INITIAL_PLANNING:S.xyI.AGENT_MODE_GENERAL,agentStackPlatformType:v})];case 5:return P.sent(),[3,7];case 6:return w=P.sent(),ey((0,a._)(w,Error)?w:Error(String(w))),[2];case 7:if(ec("opening_repl"),R={enterInAgentMode:!0,agentOnboarding:(null==ef?void 0:ef.replCount.__typename)==="ReplCount"&&(null==ef?void 0:ef.replCount.count)===0&&e_,enterInExpertMode:f,appThemeId:h},C=(0,K.q1)(E,R),!el)return[3,8];return window.location.href=(0,K.cY)(E,R),[3,10];case 8:return[4,eg.push((0,i._)((0,o._)({},C.href),{pathname:eh}),C.as)];case 9:P.sent(),P.label=10;case 10:return ec("idle"),[2]}})}).apply(this,arguments)},status:es,agentPromptRiverConnectionStatus:eE}}},53178:(e,t,r)=>{r.d(t,{A:()=>S});var n={};r.r(n),r.d(n,{checkAndTrack:()=>I,ensureTrackedFile:()=>y,storeOp:()=>b});var a=r(67276),o=r(34778),i=r(29935),s=r(12694),c=r(22531),u=r(82643),l=r(52535),d=r(58631),p=r(17844),f={};function m(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.info("ot client dataloss",(0,p._)({case:t,startTime:r.startTime,opsSinceFlush:r.opsSinceFlush,whileReconnecting:r.whileReconnecting,replid:r.replId,filePath:r.filePath},n))}var g={replsList:function(){return"dataLossRepls"},replFiles:function(e){return"dataLossReplFiles".concat(e)},latestOp:function(e,t){return"dataLossLatestOp--".concat(e,"--").concat(t)},latestFlushedOp:function(e,t){return"dataLossLatestFlushed--".concat(e,"--").concat(t)},latestOwnOp:function(e,t){return"dataLosslatestOwnOp--".concat(e,"--").concat(t)},opsSinceFlush:function(e,t){return"dataLossOpsSinceFlush--".concat(e,"--").concat(t)}};function h(){var e=d.A.get(g.replsList(),"array");return e||(e=[],d.A.set(g.replsList(),e)),e}function v(e){var t=d.A.get(g.replFiles(e),"array");return t||(t=[],d.A.set(g.replFiles(e),t)),t}function _(e){var t=v(e),r=!0,n=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var s=o.value;"string"==typeof s&&function(e,t){d.A.remove(g.latestOp(e,t)),d.A.remove(g.latestFlushedOp(e,t)),d.A.remove(g.latestOwnOp(e,t));var r=v(e).filter(function(e){return e!==t});d.A.set(g.replFiles(e),r)}(e,s)}}catch(e){n=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}d.A.remove(g.replFiles(e));var c=h().filter(function(t){return t!==e});d.A.set(g.replsList(),c)}function y(e){var t,r=e.replId,n=e.filePath;(t=h()).includes(r)||(t.length>20?(_(t[0]),t[0]=r):t.push(r),d.A.set(g.replsList(),t));var a=v(r);a.includes(n)||(a.length>20?(_(a[0]),a[0]=n):a.push(n),d.A.set(g.replFiles(r),a))}function b(e){var t=e.filePath,r=e.replId,n=e.opType,a=e.op;!function(e){var t=e.filePath,r=e.replId,n=e.opType,a=e.logger,o=e.isReconnecting,i=m.bind(null,a),s="".concat(r,"--").concat(t);f[s]||(f[s]={replId:r,filePath:t,timer:null,startTime:null,whileReconnecting:0,opsSinceFlush:0});var c=f[s];if("latestFlushedOp"===n){delete f[s];var u=c.startTime;if(u){var l=Date.now()-u;l>6e4&&i("flush_delay_received",c,{elapsed:l})}var d=c.timer;d&&(clearTimeout(d),c.timer=null)}else{c.opsSinceFlush+=1,o&&(c.whileReconnecting+=1);var p,g=null!=(p=c.startTime)?p:Date.now();c.startTime=g,c.timer||(c.timer=setTimeout(function(){i("flush_delay_timeout",c)},6e4)),150===c.opsSinceFlush?i("flush_delay_small",c):1e3===c.opsSinceFlush&&i("flush_delay_large",c)}}({filePath:t,replId:r,opType:n,logger:e.logger,isReconnecting:e.isReconnecting}),d.A.set(g[n](r,t),a)}var E={};function I(e){return(0,i._)(function(e){var t,r,n,a,o,p,f,m;return(0,u.YH)(this,function(h){return t=e.filePath,r=e.replId,n=e.serverVersion,a=e.serverContent,o=e.fetchOps,p=e.logger,E[t+r]||(E[t+r]=!0,f=function(e,t){var r={latestOp:null,latestFlushedOp:null,latestOwnOp:null},n=Object.keys(r),a=!0,o=!1,i=void 0;try{for(var s,u=n[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var l=s.value,p=d.A.get(g[l](e,t),"object");p&&p&&(void 0===p?"undefined":(0,c._)(p))==="object"&&"number"==typeof p.crc32&&"number"==typeof p.version&&(r[l]=p)}}catch(e){o=!0,i=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw i}}return r}(r,t),m=l.str(a)>>>0,Object.keys(f).forEach(function(e){return(0,i._)(function(){var t,r,a;return(0,u.YH)(this,function(i){switch(i.label){case 0:if(!(t=f[e]))return[2];if(n<t.version)return p.info("ot client dataloss",{opType:e,case:"server_forgot"}),[2];if(n===t.version)return m!==t.crc32&&p.info("ot client dataloss",{opType:e,case:"crc32_mismatch"}),[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o(t.version,t.version)];case 2:return r=s._.apply(void 0,[i.sent(),1])[0],[3,4];case 3:return a=i.sent(),p.info("ot client dataloss",{opType:e,case:"error_fetching_op",originalError:String(a)}),[2];case 4:if(!r)return p.info("ot client dataloss",{opType:e,case:"op_not_found"}),[2];return r.crc32!==t.crc32&&p.info("ot client dataloss",{opType:e,case:"crc32_mismatch"}),[2]}})})()})),[2]})}).apply(this,arguments)}function S(e){var t=e.container;return(0,a.Ay)({container:t,dataloss:n,track:o.u4})}},78624:(e,t,r)=>{r.d(t,{L:()=>i});var n=r(21462),a=r(89357),o=r(39938);function i(){var e=(0,a.RL)(),t=(0,o.A)(e);return(0,n.useCallback)(function(){var e,r;return!Number.isFinite(r=parseInt(null==(e=t.current)?void 0:e.variation("flag-container-retry-minimum-ms",0),10))||r<0?0:r},[t])}},89742:(e,t,r)=>{r.d(t,{B:()=>a});var n=r(90629);function a(e,t){return n.v4(function(r){r.setTag("start-with-ai",!0),t&&r.setExtras(t),n.Cp(e)}),e}},90352:(e,t,r)=>{r.d(t,{$:()=>c,O:()=>s});var n=r(17844),a=r(21462),o=r(23099),i=r.n(o);function s(e){var t=e.repl,r=e.currentUser;return{asViewer:e.asViewer,repl:{__typename:"Repl",authorizations:t.authorizations,id:t.id,language:t.language},currentUser:r?{__typename:"CurrentUser",id:r.id,username:r.username,isSubscribed:r.isSubscribed,roles:r.roles}:void 0}}function c(e){var t=e?s((0,n._)({},e)):null,r=(0,a.useRef)(t);return i()(t,r.current)||(r.current=t),r.current}}}]);
//# sourceMappingURL=4911-92782682c75566c4.js.map
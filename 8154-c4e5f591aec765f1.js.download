!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="174a981c-07a4-4c93-ae80-234f5539df01",e._sentryDebugIdIdentifier="sentry-dbid-174a981c-07a4-4c93-ae80-234f5539df01")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"4f7a062e"},(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8154],{3181:(e,t,n)=>{"use strict";var i;n.d(t,{v:()=>i}),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(i||(i={}))},5446:(e,t,n)=>{var i=n(29643),s=n(46027),r=n(14929),o=n(54557),a=n(38665);e.exports=function(e,t,n,l){if(!o(e))return e;t=s(t,e);for(var c=-1,h=t.length,u=h-1,d=e;null!=d&&++c<h;){var f=a(t[c]),p=n;if("__proto__"===f||"constructor"===f||"prototype"===f)break;if(c!=u){var g=d[f];void 0===(p=l?l(g,f,d):void 0)&&(p=o(g)?g:r(t[c+1])?[]:{})}i(d,f,p),d=d[f]}return e}},5844:(e,t,n)=>{var i=n(56359);e.exports=n(57766)(function(e,t){return null==e?{}:i(e,t)})},7089:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,i.default)(e),"object"===s(t)?(n=t.min||0,r=t.max):(n=arguments[1],r=arguments[2]);var n,r,o=encodeURI(e).split(/%..|./).length-1;return o>=n&&(void 0===r||o<=r)};var i=function(e){return e&&e.__esModule?e:{default:e}}(n(6235));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=t.default,e.exports.default=t.default},9550:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return((0,i.default)(t),n=String(n))?"4"===n?o.test(t):"6"===n&&l.test(t):e(t,4)||e(t,6)};var i=function(e){return e&&e.__esModule?e:{default:e}}(n(6235)),s="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",r="(".concat(s,"[.]){3}").concat(s),o=new RegExp("^".concat(r,"$")),a="(?:[0-9a-fA-F]{1,4})",l=RegExp("^("+"(?:".concat(a,":){7}(?:").concat(a,"|:)|")+"(?:".concat(a,":){6}(?:").concat(r,"|:").concat(a,"|:)|")+"(?:".concat(a,":){5}(?::").concat(r,"|(:").concat(a,"){1,2}|:)|")+"(?:".concat(a,":){4}(?:(:").concat(a,"){0,1}:").concat(r,"|(:").concat(a,"){1,3}|:)|")+"(?:".concat(a,":){3}(?:(:").concat(a,"){0,2}:").concat(r,"|(:").concat(a,"){1,4}|:)|")+"(?:".concat(a,":){2}(?:(:").concat(a,"){0,3}:").concat(r,"|(:").concat(a,"){1,5}|:)|")+"(?:".concat(a,":){1}(?:(:").concat(a,"){0,4}:").concat(r,"|(:").concat(a,"){1,6}|:)|")+"(?::((?::".concat(a,"){0,5}:").concat(r,"|(?::").concat(a,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");e.exports=t.default,e.exports.default=t.default},10752:(e,t,n)=>{"use strict";e.exports=n(18319)},18319:(e,t,n)=>{"use strict";var i=n(2272),s=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(void 0===i||void 0===i.domain)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||s.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||s.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||s.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=s.DEFAULT_MAX_PENDING};s.DEFAULT_TIMEOUT=0,s.DEFAULT_MAX_OCCUPATION_TIME=0,s.DEFAULT_MAX_EXECUTION_TIME=0,s.DEFAULT_MAX_PENDING=1e3,s.prototype.acquire=function(e,t,n,s){if(Array.isArray(e))return this._acquireBatch(e,t,n,s);if("function"!=typeof t)throw Error("You must pass a function to execute");var r=null,o=null,a=null;"function"!=typeof n&&(s=n,n=null,a=new this.Promise(function(e,t){r=e,o=t})),s=s||{};var l=!1,c=null,h=null,u=null,d=this,f=function(t,i,s){h&&(clearTimeout(h),h=null),u&&(clearTimeout(u),u=null),t&&(d.queues[e]&&0===d.queues[e].length&&delete d.queues[e],d.domainReentrant&&delete d.domains[e]),l||(a?i?o(i):r(s):"function"==typeof n&&n(i,s),l=!0),t&&d.queues[e]&&d.queues[e].length>0&&d.queues[e].shift()()},p=function(n){if(l)return f(n);c&&(clearTimeout(c),c=null),d.domainReentrant&&n&&(d.domains[e]=i.domain);var r=s.maxExecutionTime||d.maxExecutionTime;if(r&&(u=setTimeout(function(){d.queues[e]&&f(n,Error("Maximum execution time is exceeded "+e))},r)),1===t.length){var o=!1;try{t(function(e,t){o||(o=!0,f(n,e,t))})}catch(e){o||(o=!0,f(n,e))}}else d._promiseTry(function(){return t()}).then(function(e){f(n,void 0,e)},function(e){f(n,e)})};d.domainReentrant&&i.domain&&(p=i.domain.bind(p));var g=s.maxPending||d.maxPending;if(d.queues[e])if(d.domainReentrant&&i.domain&&i.domain===d.domains[e])p(!1);else if(d.queues[e].length>=g)f(!1,Error("Too many pending tasks in queue "+e));else{var y=function(){p(!0)};s.skipQueue?d.queues[e].unshift(y):d.queues[e].push(y);var m=s.timeout||d.timeout;m&&(c=setTimeout(function(){c=null,f(!1,Error("async-lock timed out in queue "+e))},m))}else d.queues[e]=[],p(!0);var v=s.maxOccupationTime||d.maxOccupationTime;if(v&&(h=setTimeout(function(){d.queues[e]&&f(!1,Error("Maximum occupation time is exceeded in queue "+e))},v)),a)return a},s.prototype._acquireBatch=function(e,t,n,i){"function"!=typeof n&&(i=n,n=null);var s=this,r=e.reduceRight(function(e,t){return function(n){s.acquire(t,e,n,i)}},t);if("function"!=typeof n)return new this.Promise(function(e,t){1===r.length?r(function(n,i){n?t(n):e(i)}):e(r())});r(n)},s.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},s.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},e.exports=s},20369:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,i.default)(e),(t=(0,a.default)(t,c)).require_display_name||t.allow_display_name){var n=e.match(h);if(n){var l,y,m=n[1];if(e=e.replace(m,"").replace(/(^<|>$)/g,""),m.endsWith(" ")&&(m=m.slice(0,-1)),!(!(!(y=(l=m).replace(/^"(.+)"$/,"$1")).trim()||/[\.";<>]/.test(y)&&(y===l||y.split('"').length!==y.split('\\"').length))&&1))return!1}else if(t.require_display_name)return!1}if(!t.ignore_max_length&&e.length>254)return!1;var v=e.split("@"),w=v.pop(),b=w.toLowerCase();if(t.host_blacklist.includes(b)||t.host_whitelist.length>0&&!t.host_whitelist.includes(b))return!1;var x=v.join("@");if(t.domain_specific_validation&&("gmail.com"===b||"googlemail.com"===b)){var E=(x=x.toLowerCase()).split("+")[0];if(!(0,s.default)(E.replace(/\./g,""),{min:6,max:30}))return!1;for(var S=E.split("."),k=0;k<S.length;k++)if(!d.test(S[k]))return!1}if(!1===t.ignore_max_length&&(!(0,s.default)(x,{max:64})||!(0,s.default)(w,{max:254})))return!1;if(!(0,r.default)(w,{require_tld:t.require_tld,ignore_max_length:t.ignore_max_length,allow_underscores:t.allow_underscores})){if(!t.allow_ip_domain)return!1;if(!(0,o.default)(w)){if(!w.startsWith("[")||!w.endsWith("]"))return!1;var _=w.slice(1,-1);if(0===_.length||!(0,o.default)(_))return!1}}if('"'===x[0])return x=x.slice(1,x.length-1),t.allow_utf8_local_part?g.test(x):f.test(x);for(var C=t.allow_utf8_local_part?p:u,U=x.split("."),M=0;M<U.length;M++)if(!C.test(U[M]))return!1;return!t.blacklisted_chars||-1===x.search(RegExp("[".concat(t.blacklisted_chars,"]+"),"g"))};var i=l(n(6235)),s=l(n(7089)),r=l(n(69696)),o=l(n(9550)),a=l(n(29588));function l(e){return e&&e.__esModule?e:{default:e}}var c={allow_display_name:!1,allow_underscores:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[],host_whitelist:[]},h=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,u=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,d=/^[a-z\d]+$/,f=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,p=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A1-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,g=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i;e.exports=t.default,e.exports.default=t.default},25547:(e,t,n)=>{var i=n(69246),s=n(59099),r=n(33455),o=n(46027),a=n(47225),l=n(92642),c=n(57766),h=n(69047);e.exports=c(function(e,t){var n={};if(null==e)return n;var c=!1;t=i(t,function(t){return t=o(t,e),c||(c=t.length>1),t}),a(e,h(e),n),c&&(n=s(n,7,l));for(var u=t.length;u--;)r(n,t[u]);return n})},29588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;for(var n in t)void 0===e[n]&&(e[n]=t[n]);return e},e.exports=t.default,e.exports.default=t.default},29897:e=>{e.exports=function(e){var t;if("string"!=typeof e||""===e)return!1;for(;t=/(\\).|([@?!+*]\(.*\))/g.exec(e);){if(t[2])return!0;e=e.slice(t.index+t[0].length)}return!1}},30977:(e,t,n)=>{"use strict";n.d(t,{B:()=>h,L:()=>c});var i=n(81720),s=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,s,r=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},r=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=s(e,2);return[t[0],t[1]]})},e.prototype.setEntry=function(t,n){var i=new e(this._entries);return i._entries.set(t,n),i},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t,n,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var o=new e(this._entries);try{for(var a=r(i),l=a.next();!l.done;l=a.next()){var c=l.value;o._entries.delete(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o},e.prototype.clear=function(){return new e},e}(),a=Symbol("BaggageEntryMetadata"),l=i.K.instance();function c(e){return void 0===e&&(e={}),new o(new Map(Object.entries(e)))}function h(e){return"string"!=typeof e&&(l.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:a,toString:function(){return e}}}},33455:(e,t,n)=>{var i=n(46027),s=n(95782),r=n(60563),o=n(38665);e.exports=function(e,t){return t=i(t,e),null==(e=r(e,t))||delete e[o(s(t))]}},36312:(e,t,n)=>{"use strict";n.d(t,{MU:()=>es,xp:()=>ef,bd:()=>P,kc:()=>eg,Yb:()=>ey});var i=n(91630),s=n(57010);n(95570);var r={debug:-1,info:0,warn:1,error:2},o=e=>(t,n)=>{if(n&&!n.telemetry){let e=i.u.getSpan(s._.active());e&&(n.telemetry={traceId:e.spanContext().traceId,spanId:e.spanContext().spanId})}if(!n?.transportMessage)return void e(t,n);let{payload:r,...o}=n.transportMessage;n.transportMessage=o,e(t,n)},a=class{minLevel;output;constructor(e,t="info"){this.minLevel=t,this.output=e}debug(e,t){r[this.minLevel]<=r.debug&&this.output(e,t??{},"debug")}info(e,t){r[this.minLevel]<=r.info&&this.output(e,t??{},"info")}warn(e,t){r[this.minLevel]<=r.warn&&this.output(e,t??{},"warn")}error(e,t){r[this.minLevel]<=r.error&&this.output(e,t??{},"error")}},l=e=>({debug:o(e.debug.bind(e)),info:o(e.info.bind(e)),warn:o(e.warn.bind(e)),error:o(e.error.bind(e))}),c=n(68248),h=n(46308);class u{constructor(e,t){this.type=e,this.data=t}}class d extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Object.create(d.prototype)),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:d.name})}}function f(e,t,n){let i=Math.floor(n/0x100000000);e.setUint32(t,i),e.setUint32(t+4,n)}function p(e,t){return 0x100000000*e.getInt32(t)+e.getUint32(t+4)}let g={type:-1,encode:function(e){return e instanceof Date?function({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=0x3ffffffff)if(0===t&&e<=0xffffffff){let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}else{let n=e/0x100000000,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,t<<2|3&n),s.setUint32(4,0|e),i}{let n=new Uint8Array(12),i=new DataView(n.buffer);return i.setUint32(0,t),f(i,4,e),n}}(function(e){let t=e.getTime(),n=Math.floor(t/1e3),i=(t-1e3*n)*1e6,s=Math.floor(i/1e9);return{sec:n+s,nsec:i-1e9*s}}(e)):null},decode:function(e){let t=function(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:{let e=t.getUint32(0);return{sec:(3&e)*0x100000000+t.getUint32(4),nsec:e>>>2}}case 12:return{sec:p(t,4),nsec:t.getUint32(0)};default:throw new d(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}};class y{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(g)}register({type:e,encode:t,decode:n}){if(e>=0)this.encoders[e]=t,this.decoders[e]=n;else{let i=-1-e;this.builtInEncoders[i]=t,this.builtInDecoders[i]=n}}tryToEncode(e,t){for(let n=0;n<this.builtInEncoders.length;n++){let i=this.builtInEncoders[n];if(null!=i){let s=i(e,t);if(null!=s)return new u(-1-n,s)}}for(let n=0;n<this.encoders.length;n++){let i=this.encoders[n];if(null!=i){let s=i(e,t);if(null!=s)return new u(n,s)}}return e instanceof u?e:null}decode(e,t,n){let i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,n):new u(t,e)}}y.defaultCodec=new y;let m=new TextEncoder;function v(e,t,n){let i=t,s=i+n,r=[],o="";for(;i<s;){let t=e[i++];if((128&t)==0)r.push(t);else if((224&t)==192){let n=63&e[i++];r.push((31&t)<<6|n)}else if((240&t)==224){let n=63&e[i++],s=63&e[i++];r.push((31&t)<<12|n<<6|s)}else if((248&t)==240){let n=63&e[i++],s=(7&t)<<18|n<<12|(63&e[i++])<<6|63&e[i++];s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s)}else r.push(t);r.length>=4096&&(o+=String.fromCharCode(...r),r.length=0)}return r.length>0&&(o+=String.fromCharCode(...r)),o}let w=new TextDecoder;function b(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}class x{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??y.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??100,this.initialBufferSize=e?.initialBufferSize??2048,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new x({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){let t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){let t=new ArrayBuffer(e),n=new Uint8Array(t),i=new DataView(t);n.set(this.bytes),this.view=i,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<0x100000000?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-0x80000000?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<0x100000000)this.writeU8(219),this.writeU32(e);else throw Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let t=function(e){let t=e.length,n=0,i=0;for(;i<t;){let s=e.charCodeAt(i++);if((0xffffff80&s)==0){n++;continue}if((0xfffff800&s)==0)n+=2;else{if(s>=55296&&s<=56319&&i<t){let t=e.charCodeAt(i);(64512&t)==56320&&(++i,s=((1023&s)<<10)+(1023&t)+65536)}(0xffff0000&s)==0?n+=3:n+=4}}return n}(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,n){if(e.length>50)m.encodeInto(e,t.subarray(n));else!function(e,t,n){let i=e.length,s=n,r=0;for(;r<i;){let n=e.charCodeAt(r++);if((0xffffff80&n)==0){t[s++]=n;continue}if((0xfffff800&n)==0)t[s++]=n>>6&31|192;else{if(n>=55296&&n<=56319&&r<i){let t=e.charCodeAt(r);(64512&t)==56320&&(++r,n=((1023&n)<<10)+(1023&t)+65536)}(0xffff0000&n)==0?t[s++]=n>>12&15|224:(t[s++]=n>>18&7|240,t[s++]=n>>12&63|128),t[s++]=n>>6&63|128}t[s++]=63&n|128}}(e,t,n)}(e,this.bytes,this.pos),this.pos+=t}encodeObject(e,t){let n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<0x100000000)this.writeU8(198),this.writeU32(t);else throw Error(`Too large binary: ${t}`);let n=b(e);this.writeU8a(n)}encodeArray(e,t){let n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<0x100000000)this.writeU8(221),this.writeU32(n);else throw Error(`Too large array: ${n}`);for(let n of e)this.doEncode(n,t+1)}countWithoutUndefined(e,t){let n=0;for(let i of t)void 0!==e[i]&&n++;return n}encodeMap(e,t){let n=Object.keys(e);this.sortKeys&&n.sort();let i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<0x100000000)this.writeU8(223),this.writeU32(i);else throw Error(`Too large map object: ${i}`);for(let i of n){let n=e[i];this.ignoreUndefined&&void 0===n||(this.encodeString(i),this.doEncode(n,t+1))}}encodeExtension(e){if("function"==typeof e.data){let t=e.data(this.pos+6),n=t.length;if(n>=0x100000000)throw Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(t);return}let t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<0x100000000)this.writeU8(201),this.writeU32(t);else throw Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){var t,n;this.ensureBufferSizeToWrite(8),t=this.view,n=this.pos,t.setUint32(n,e/0x100000000),t.setUint32(n+4,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),f(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function E(e,t){return new x(t).encodeSharedRef(e)}function S(e){return`${e<0?"-":""}0x${Math.abs(e).toString(16).padStart(2,"0")}`}class k{constructor(e=16,t=16){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let e=0;e<this.maxKeyLength;e++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,n){let i=this.caches[n-1];e:for(let s of i){let i=s.bytes;for(let s=0;s<n;s++)if(i[s]!==e[t+s])continue e;return s.str}return null}store(e,t){let n=this.caches[e.length-1],i={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)}decode(e,t,n){let i=this.find(e,t,n);if(null!=i)return this.hit++,i;this.miss++;let s=v(e,t,n),r=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(r,s),s}}let _="array",C="map_key",U="map_value",M=e=>{if("string"==typeof e||"number"==typeof e)return e;throw new d("The type of key must be string or number but "+typeof e)};class B{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){let t=this.getUninitializedStateFromPool();t.type=_,t.position=0,t.size=e,t.array=Array(e)}pushMapState(e){let t=this.getUninitializedStateFromPool();t.type=C,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw Error("Invalid stack state. Released state is not on top of the stack.");e.type===_&&(e.size=0,e.array=void 0,e.position=0,e.type=void 0),(e.type===C||e.type===U)&&(e.size=0,e.map=void 0,e.readCount=0,e.type=void 0),this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}let I=new DataView(new ArrayBuffer(0)),T=new Uint8Array(I.buffer);try{I.getInt8(0)}catch(e){if(!(e instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}let O=RangeError("Insufficient data"),L=new k;class A{constructor(e){this.totalPos=0,this.pos=0,this.view=I,this.bytes=T,this.headByte=-1,this.stack=new B,this.entered=!1,this.extensionCodec=e?.extensionCodec??y.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??0xffffffff,this.maxBinLength=e?.maxBinLength??0xffffffff,this.maxArrayLength=e?.maxArrayLength??0xffffffff,this.maxMapLength=e?.maxMapLength??0xffffffff,this.maxExtLength=e?.maxExtLength??0xffffffff,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:L,this.mapKeyConverter=e?.mapKeyConverter??M}clone(){return new A({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(e){let t=b(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){let t=this.bytes.subarray(this.pos),n=b(e),i=new Uint8Array(t.length+n.length);i.set(t),i.set(n,t.length),this.setBuffer(i)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:t,pos:n}=this;return RangeError(`Extra ${t.byteLength-n} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);let t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){let t=this.clone();yield*t.decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{let t;this.entered=!0;let n=!1;for await(let i of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(i);try{t=this.doDecodeSync(),n=!0}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return t}let{headByte:i,pos:s,totalPos:r}=this;throw RangeError(`Insufficient data in parsing ${S(i)} at ${r} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async *decodeMultiAsync(e,t){if(this.entered){let n=this.clone();yield*n.decodeMultiAsync(e,t);return}try{this.entered=!0;let n=t,i=-1;for await(let s of e){if(t&&0===i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--i;);}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){t:for(;;){let e,t=this.readHeadByte();if(t>=224)e=t-256;else if(t<192)if(t<128)e=t;else if(t<144){let n=t-128;if(0!==n){this.pushMapState(n),this.complete();continue}e={}}else if(t<160){let n=t-144;if(0!==n){this.pushArrayState(n),this.complete();continue}e=[]}else{let n=t-160;e=this.decodeString(n,0)}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===t){let t=this.lookU8();e=this.decodeString(t,1)}else if(218===t){let t=this.lookU16();e=this.decodeString(t,2)}else if(219===t){let t=this.lookU32();e=this.decodeString(t,4)}else if(220===t){let t=this.readU16();if(0!==t){this.pushArrayState(t),this.complete();continue}e=[]}else if(221===t){let t=this.readU32();if(0!==t){this.pushArrayState(t),this.complete();continue}e=[]}else if(222===t){let t=this.readU16();if(0!==t){this.pushMapState(t),this.complete();continue}e={}}else if(223===t){let t=this.readU32();if(0!==t){this.pushMapState(t),this.complete();continue}e={}}else if(196===t){let t=this.lookU8();e=this.decodeBinary(t,1)}else if(197===t){let t=this.lookU16();e=this.decodeBinary(t,2)}else if(198===t){let t=this.lookU32();e=this.decodeBinary(t,4)}else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t){let t=this.lookU8();e=this.decodeExtension(t,1)}else if(200===t){let t=this.lookU16();e=this.decodeExtension(t,2)}else if(201===t){let t=this.lookU32();e=this.decodeExtension(t,4)}else throw new d(`Unrecognized type byte: ${S(t)}`);this.complete();let n=this.stack;for(;n.length>0;){let t=n.top();if(t.type===_)if(t.array[t.position]=e,t.position++,t.position===t.size)e=t.array,n.release(t);else continue t;else if(t.type===C){if("__proto__"===e)throw new d("The key __proto__ is not allowed");t.key=this.mapKeyConverter(e),t.type=U;continue t}else if(t.map[t.key]=e,t.readCount++,t.readCount===t.size)e=t.map,n.release(t);else{t.key=null,t.type=C;continue t}}return e}}readHeadByte(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new d(`Unrecognized array type byte: ${S(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new d(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new d(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){let n;if(e>this.maxStrLength)throw new d(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw O;let i=this.pos+t;return n=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?this.keyDecoder.decode(this.bytes,i,e):function(e,t,n){if(!(n>200))return v(e,t,n);let i=e.subarray(t,t+n);return w.decode(i)}(this.bytes,i,e),this.pos+=t+e,n}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===C}decodeBinary(e,t){if(e>this.maxBinLength)throw new d(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw O;let n=this.pos+t,i=this.bytes.subarray(n,n+e);return this.pos+=t+e,i}decodeExtension(e,t){if(e>this.maxExtLength)throw new d(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let n=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){var e,t;let n=(e=this.view,t=this.pos,0x100000000*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n}readI64(){let e=p(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){let e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){let e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function $(e,t){return new A(t).decode(e)}var D=n(97858),R=n(16128),P={RetriesExceeded:"conn_retry_exceeded",HandshakeFailed:"handshake_failed",MessageOrderingViolated:"message_ordering_violated",InvalidMessage:"invalid_message",MessageSendFailure:"message_send_failure"},H=class{eventListeners={};removeAllListeners(){this.eventListeners={}}numberOfListeners(e){return this.eventListeners[e]?.size??0}addEventListener(e,t){this.eventListeners[e]||(this.eventListeners[e]=new Set),this.eventListeners[e]?.add(t)}removeEventListener(e,t){this.eventListeners[e]&&this.eventListeners[e]?.delete(t)}dispatchEvent(e,t){let n=this.eventListeners[e];if(n)for(let e of[...n])e(t)}},F=new TextEncoder,j=new TextDecoder,N={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:e=>F.encode(JSON.stringify(e,function(e){let t=this[e];if(t instanceof Uint8Array){let e;return{$t:(e="",t.forEach(t=>{e+=String.fromCharCode(t)}),btoa(e))}}return"bigint"==typeof t?{$b:t.toString()}:t})),fromBuffer:e=>{let t=JSON.parse(j.decode(e),function(e,t){return t?.$t!==void 0?function(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(t.$t):t?.$b!==void 0?BigInt(t.$b):t});if("object"!=typeof t||null===t)throw Error("unpacked msg is not an object");return t}}},q={...N,baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200,isFatalConnectionError:()=>!1},z=(e=>(e.NoConnection="NoConnection",e.BackingOff="BackingOff",e.Connecting="Connecting",e.Handshaking="Handshaking",e.Connected="Connected",e.WaitingForHandshake="WaitingForHandshake",e))(z||{}),W="session state has been consumed and is no longer valid",Z=class{_isConsumed;close(){this._handleClose()}constructor(){return this._isConsumed=!1,new Proxy(this,{get(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return()=>{e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return()=>{e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error(`${W}: getting ${t.toString()} on consumed state`);return Reflect.get(e,t)},set(e,t,n){if(e._isConsumed)throw Error(`${W}: setting ${t.toString()} on consumed state`);return Reflect.set(e,t,n)}})}},V=class extends Z{from;options;codec;tracer;log;constructor({from:e,options:t,log:n,tracer:i,codec:s}){super(),this.from=e,this.options=t,this.log=n,this.tracer=i,this.codec=s}},G=class extends V{id;telemetry;to;protocolVersion;seq;seqSent;ack;sendBuffer;constructor(e){let{id:t,to:n,seq:i,ack:s,sendBuffer:r,telemetry:o,log:a,protocolVersion:l,seqSent:c}=e;super(e),this.id=t,this.to=n,this.seq=i,this.ack=s,this.sendBuffer=r,this.telemetry=o,this.log=a,this.protocolVersion=l,this.seqSent=c}get loggingMetadata(){let e={clientId:this.from,connectedTo:this.to,sessionId:this.id};if(this.telemetry.span.isRecording()){let t=this.telemetry.span.spanContext();e.telemetry={traceId:t.traceId,spanId:t.spanId}}return e}constructMsg(e){let t={...e,id:(0,c.$C)(),to:this.to,from:this.from,seq:this.seq,ack:this.ack};return this.seq++,t}nextSeq(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}send(e){let t=this.constructMsg(e);return this.sendBuffer.push(t),{ok:!0,value:t.id}}_handleStateExit(){}_handleClose(){this.sendBuffer.length=0,this.telemetry.span.end()}},K=class extends G{graceExpiryTime;gracePeriodTimeout;listeners;constructor(e){super(e),this.listeners=e.listeners,this.graceExpiryTime=e.graceExpiryTime,this.gracePeriodTimeout=setTimeout(()=>{this.listeners.onSessionGracePeriodElapsed()},this.graceExpiryTime-Date.now())}_handleStateExit(){super._handleStateExit(),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}_handleClose(){super._handleClose()}};function J(e,t,n){let i=t.toBuffer(n);return i.ok?e.send(i.value)?{ok:!0,value:n.id}:{ok:!1,reason:"failed to send message"}:i}var X=class extends K{state="Connecting";connPromise;listeners;connectionTimeout;constructor(e){super(e),this.connPromise=e.connPromise,this.listeners=e.listeners,this.connPromise.then(e=>{this._isConsumed||this.listeners.onConnectionEstablished(e)},e=>{this._isConsumed||this.listeners.onConnectionFailed(e)}),this.connectionTimeout=setTimeout(()=>{this.listeners.onConnectionTimeout()},this.options.connectionTimeoutMs)}bestEffortClose(){let e=this.log,t=this.loggingMetadata;this.connPromise.then(n=>{n.close(),e?.info("connection eventually resolved but session has transitioned, closed connection",{...t,...n.loggingMetadata})}).catch(()=>{})}_handleStateExit(){super._handleStateExit(),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}_handleClose(){super._handleClose(),this.bestEffortClose()}},Y=class extends K{state="NoConnection";_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit()}},Q=class extends V{state="WaitingForHandshake";conn;listeners;handshakeTimeout;constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.handshakeTimeout=setTimeout(()=>{this.listeners.onHandshakeTimeout()},this.options.handshakeTimeoutMs),this.conn.setDataListener(this.onHandshakeData),this.conn.setErrorListener(this.listeners.onConnectionErrored),this.conn.setCloseListener(this.listeners.onConnectionClosed)}get loggingMetadata(){return{clientId:this.from,connId:this.conn.id,...this.conn.loggingMetadata}}onHandshakeData=e=>{let t=this.codec.fromBuffer(e);if(!t.ok)return void this.listeners.onInvalidHandshake(`could not parse handshake message: ${t.reason}`,"MALFORMED_HANDSHAKE");this.listeners.onHandshake(t.value)};sendHandshake(e){return J(this.conn,this.codec,e)}_handleStateExit(){this.conn.removeDataListener(),this.conn.removeErrorListener(),this.conn.removeCloseListener(),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0}_handleClose(){this.conn.close()}},ee=class extends K{state="Handshaking";conn;listeners;handshakeTimeout;constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.handshakeTimeout=setTimeout(()=>{this.listeners.onHandshakeTimeout()},this.options.handshakeTimeoutMs),this.conn.setDataListener(this.onHandshakeData),this.conn.setErrorListener(this.listeners.onConnectionErrored),this.conn.setCloseListener(this.listeners.onConnectionClosed)}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}onHandshakeData=e=>{let t=this.codec.fromBuffer(e);if(!t.ok)return void this.listeners.onInvalidHandshake(`could not parse handshake message: ${t.reason}`,"MALFORMED_HANDSHAKE");this.listeners.onHandshake(t.value)};sendHandshake(e){return J(this.conn,this.codec,e)}_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(),this.conn.removeErrorListener(),this.conn.removeCloseListener(),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},et=class extends G{state="Connected";conn;listeners;heartbeatHandle;heartbeatMissTimeout;isActivelyHeartbeating=!1;updateBookkeeping(e,t){this.sendBuffer=this.sendBuffer.filter(t=>t.seq>=e),this.ack=t+1,this.heartbeatMissTimeout&&clearTimeout(this.heartbeatMissTimeout),this.startMissingHeartbeatTimeout()}assertSendOrdering(e){if(e.seq>this.seqSent+1){let t=`invariant violation: would have sent out of order msg (seq: ${e.seq}, expected: ${this.seqSent} + 1)`;throw this.log?.error(t,{...this.loggingMetadata,transportMessage:e,tags:["invariant-violation"]}),Error(t)}}send(e){let t=this.constructMsg(e);this.assertSendOrdering(t),this.sendBuffer.push(t);let n=J(this.conn,this.codec,t);return n.ok?this.seqSent=t.seq:this.listeners.onMessageSendFailure(t,n.reason),n}constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.conn.setDataListener(this.onMessageData),this.conn.setCloseListener(this.listeners.onConnectionClosed),this.conn.setErrorListener(this.listeners.onConnectionErrored)}sendBufferedMessages(){if(this.sendBuffer.length>0)for(let e of(this.log?.info(`sending ${this.sendBuffer.length} buffered messages, starting at seq ${this.nextSeq()}`,this.loggingMetadata),this.sendBuffer)){this.assertSendOrdering(e);let t=J(this.conn,this.codec,e);if(!t.ok)return this.listeners.onMessageSendFailure(e,t.reason),t;this.seqSent=e.seq}return{ok:!0,value:void 0}}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}startMissingHeartbeatTimeout(){let e=this.options.heartbeatsUntilDead,t=e*this.options.heartbeatIntervalMs;this.heartbeatMissTimeout=setTimeout(()=>{this.log?.info(`closing connection to ${this.to} due to inactivity (missed ${e} heartbeats which is ${t}ms)`,this.loggingMetadata),this.telemetry.span.addEvent("closing connection due to missing heartbeat"),this.conn.close()},t)}startActiveHeartbeat(){this.isActivelyHeartbeating=!0,this.heartbeatHandle=setInterval(()=>{this.sendHeartbeat()},this.options.heartbeatIntervalMs)}sendHeartbeat(){this.log?.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}onMessageData=e=>{let t=this.codec.fromBuffer(e);if(!t.ok)return void this.listeners.onInvalidMessage(`could not parse message: ${t.reason}`);let n=t.value;if(n.seq!==this.ack){if(n.seq<this.ack)this.log?.debug(`received duplicate msg (got seq: ${n.seq}, wanted seq: ${this.ack}), discarding`,{...this.loggingMetadata,transportMessage:n});else{let e=`received out-of-order msg, closing connection (got seq: ${n.seq}, wanted seq: ${this.ack})`;this.log?.error(e,{...this.loggingMetadata,transportMessage:n,tags:["invariant-violation"]}),this.telemetry.span.setStatus({code:h.s.ERROR,message:e}),this.conn.close()}return}if(this.log?.debug("received msg",{...this.loggingMetadata,transportMessage:n}),this.updateBookkeeping(n.ack,n.seq),!(0,c.o0)(n.controlFlags))return void this.listeners.onMessage(n);this.log?.debug("discarding msg (ack bit set)",{...this.loggingMetadata,transportMessage:n}),this.isActivelyHeartbeating||this.sendHeartbeat()};_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(),this.conn.removeCloseListener(),this.conn.removeErrorListener(),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0),this.heartbeatMissTimeout&&(clearTimeout(this.heartbeatMissTimeout),this.heartbeatMissTimeout=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},en=class extends K{state="BackingOff";listeners;backoffTimeout;constructor(e){super(e),this.listeners=e.listeners,this.backoffTimeout=setTimeout(()=>{this.listeners.onBackoffFinished()},e.backoffMs)}_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit(),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}},ei=new y;ei.register({type:0,encode:e=>"bigint"!=typeof e?null:e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER?E(Number(e)):E(String(e)),decode(e){let t=$(e);if("string"!=typeof t&&"number"!=typeof t)throw new d(`unexpected BigInt source: ${typeof t}`);return BigInt(t)}});var es={toBuffer:e=>E(e,{ignoreUndefined:!0,extensionCodec:ei}),fromBuffer:e=>{let t=$(e,{extensionCodec:ei});if("object"!=typeof t||null===t)throw Error("unpacked msg is not an object");return t}},er=class{constructor(e){this.codec=e}toBuffer(e){try{return{ok:!0,value:this.codec.toBuffer(e)}}catch(e){return{ok:!1,reason:(0,c.xH)(e)}}}fromBuffer(e){try{let t=this.codec.fromBuffer(e);if(!D.J(c.bH,t))return{ok:!1,reason:"transport message schema mismatch"};return{ok:!0,value:t}}catch(e){return{ok:!1,reason:(0,c.xH)(e)}}}};function eo(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,seqSent:e.seqSent,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log,tracer:e.tracer,protocolVersion:e.protocolVersion,codec:e.codec}}function ea(e){return{...eo(e),graceExpiryTime:e.graceExpiryTime}}var el={entrypoints:{NoConnection:(e,t,n,i,s,r,o)=>{let a=`session-${(0,c.$C)()}`,l=(0,c.iH)(r,a,e,t),h=new Y({listeners:n,id:a,from:t,to:e,seq:0,ack:0,seqSent:0,graceExpiryTime:Date.now()+i.sessionDisconnectGraceMs,sendBuffer:[],telemetry:l,options:i,protocolVersion:s,tracer:r,log:o,codec:new er(i.codec)});return h.log?.info(`session ${h.id} created in NoConnection state`,{...h.loggingMetadata,tags:["state-transition"]}),h},WaitingForHandshake:(e,t,n,i,s,r)=>{let o=new Q({conn:t,listeners:n,from:e,options:i,tracer:s,log:r,codec:new er(i.codec)});return o.log?.info("session created in WaitingForHandshake state",{...o.loggingMetadata,tags:["state-transition"]}),o}},transition:{NoConnectionToBackingOff:(e,t,n)=>{let i=ea(e);e._handleStateExit();let s=new en({backoffMs:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from NoConnection to BackingOff`,{...s.loggingMetadata,tags:["state-transition"]}),s},BackingOffToConnecting:(e,t,n)=>{let i=ea(e);e._handleStateExit();let s=new X({connPromise:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from BackingOff to Connecting`,{...s.loggingMetadata,tags:["state-transition"]}),s},ConnectingToHandshaking:(e,t,n)=>{let i=ea(e);e._handleStateExit();let s=new ee({conn:t,listeners:n,...i});return t.telemetry=(0,c._I)(s.tracer,t,s.telemetry),s.log?.info(`session ${s.id} transition from Connecting to Handshaking`,{...s.loggingMetadata,tags:["state-transition"]}),s},HandshakingToConnected:(e,t)=>{let n=eo(e),i=e.conn;e._handleStateExit();let s=new et({conn:i,listeners:t,...n});return s.startMissingHeartbeatTimeout(),s.log?.info(`session ${s.id} transition from Handshaking to Connected`,{...s.loggingMetadata,tags:["state-transition"]}),s},WaitingForHandshakeToConnected:(e,t,n,i,s,r,o)=>{let a=e.conn,{from:l,options:h}=e,u=t?eo(t):{id:n,from:l,to:i,seq:0,ack:0,seqSent:0,sendBuffer:[],telemetry:(0,c.iH)(e.tracer,n,i,l,s),options:h,tracer:e.tracer,log:e.log,protocolVersion:o,codec:new er(h.codec)};e._handleStateExit(),t?._handleStateExit();let d=new et({conn:a,listeners:r,...u});return d.startMissingHeartbeatTimeout(),a.telemetry=(0,c._I)(d.tracer,a,d.telemetry),d.log?.info(`session ${d.id} transition from WaitingForHandshake to Connected`,{...d.loggingMetadata,tags:["state-transition"]}),d},BackingOffToNoConnection:(e,t)=>{let n=ea(e);e._handleStateExit();let i=new Y({listeners:t,...n});return i.log?.info(`session ${i.id} transition from BackingOff to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectingToNoConnection:(e,t)=>{let n=ea(e);e.bestEffortClose(),e._handleStateExit();let i=new Y({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Connecting to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},HandshakingToNoConnection:(e,t)=>{let n=ea(e);e.conn.close(),e._handleStateExit();let i=new Y({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Handshaking to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectedToNoConnection:(e,t)=>{let n=eo(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();let s=new Y({listeners:t,graceExpiryTime:i,...n});return s.log?.info(`session ${s.id} transition from Connected to NoConnection`,{...s.loggingMetadata,tags:["state-transition"]}),s}}},ec=el.transition,eh={entrypoint:el.entrypoints.NoConnection,transition:{NoConnectionToBackingOff:ec.NoConnectionToBackingOff,BackingOffToConnecting:ec.BackingOffToConnecting,ConnectingToHandshaking:ec.ConnectingToHandshaking,HandshakingToConnected:ec.HandshakingToConnected,BackingOffToNoConnection:ec.BackingOffToNoConnection,ConnectingToNoConnection:ec.ConnectingToNoConnection,HandshakingToNoConnection:ec.HandshakingToNoConnection,ConnectedToNoConnection:ec.ConnectedToNoConnection}},eu=(el.entrypoints.WaitingForHandshake,ec.WaitingForHandshakeToConnected,ec.ConnectedToNoConnection,class{status;clientId;eventDispatcher;options;log;tracer;sessions;constructor(e,t){this.options={...N,...t},this.eventDispatcher=new H,this.clientId=e,this.status="open",this.sessions=new Map,this.tracer=(0,c.EK)()}bindLogger(e,t){if("function"==typeof e){this.log=l(new a(e,t));return}this.log=l(e)}handleMsg(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}addEventListener(e,t){this.eventDispatcher.addEventListener(e,t)}removeEventListener(e,t){this.eventDispatcher.removeEventListener(e,t)}protocolError(e){this.eventDispatcher.dispatchEvent("protocolError",e)}close(){for(let e of(this.status="closed",Array.from(this.sessions.values())))this.deleteSession(e);this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),this.log?.info("manually closed transport",{clientId:this.clientId})}getStatus(){return this.status}createSession(e){let t=this.sessions.get(e.to);if(t){let n=`attempt to create session for ${e.to} but active session (${t.id}) already exists`;throw this.log?.error(n,{...e.loggingMetadata,tags:["invariant-violation"]}),Error(n)}this.sessions.set(e.to,e),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"created",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,id:e.id})}updateSession(e){let t=this.sessions.get(e.to);if(!t){let t=`attempt to transition session for ${e.to} but no active session exists`;throw this.log?.error(t,{...e.loggingMetadata,tags:["invariant-violation"]}),Error(t)}if(t.id!==e.id){let n=`attempt to transition active session for ${e.to} but active session (${t.id}) is different from handle (${e.id})`;throw this.log?.error(n,{...e.loggingMetadata,tags:["invariant-violation"]}),Error(n)}this.sessions.set(e.to,e),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,id:e.id})}deleteSession(e,t){if(e._isConsumed)return;let n=e.loggingMetadata;n.tags&&t?.unhealthy&&n.tags.push("unhealthy-session"),e.log?.info(`closing session ${e.id}`,n),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"closing",session:e});let i=e.to;e.close(),this.sessions.delete(i),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"closed",session:{id:e.id,to:i}})}onSessionGracePeriodElapsed(e){this.log?.info(`session to ${e.to} grace period elapsed, closing`,e.loggingMetadata),this.deleteSession(e)}onConnectingFailed(e){let t=el.transition.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}});return this.updateSession(t),t}onConnClosed(e){let t;return t="Handshaking"===e.state?el.transition.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}):el.transition.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}),this.updateSession(t),t}getSessionBoundSendFn(e,t){if("open"!==this.getStatus())throw Error("cannot get a bound send function on a closed transport");return n=>{let i=this.sessions.get(e);if(!i)throw Error(`session scope for ${t} has ended (close), can't send`);if(i.id!==t||i._isConsumed)throw Error(`session scope for ${t} has ended (transition), can't send`);let s=i.send(n);if(!s.ok)throw Error(s.reason);return s.value}}}),ed=class{budgetConsumed;intervalHandle;options;constructor(e){this.options=e,this.budgetConsumed=0}getBackoffMs(){if(0===this.getBudgetConsumed())return 0;let e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*2**e,this.options.maxBackoffMs)+t}get totalBudgetRestoreTime(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}consumeBudget(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}getBudgetConsumed(){return this.budgetConsumed}hasBudget(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}startRestoringBudget(){if(this.intervalHandle)return;let e=()=>{let e=this.budgetConsumed;if(!e)return void this.stopLeak();let t=e-1;0!==t&&(this.budgetConsumed=t)};this.intervalHandle=setInterval(e,this.options.budgetRestoreIntervalMs)}stopLeak(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}close(){this.stopLeak()}},ef=class extends eu{options;retryBudget;reconnectOnConnectionDrop=!0;handshakeExtensions;sessions;constructor(e,t){super(e,t),this.sessions=new Map,this.options={...q,...t},this.retryBudget=new ed(this.options)}extendHandshake(e){this.handshakeExtensions=e}tryReconnecting(e){let t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}createUnconnectedSession(e){let t=eh.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}},this.options,c.mH,this.tracer,this.log);return this.createSession(t),t}onConnectingFailed(e){let t=super.onConnectingFailed(e);return this.tryReconnecting(t.to),t}onConnClosed(e){let t=super.onConnClosed(e);return this.tryReconnecting(t.to),t}onConnectionEstablished(e,t){let n=eh.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:e=>{let t=(0,c.xH)(e);this.log?.error(`connection to ${n.to} errored during handshake: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.warn(`connection to ${n.to} closed during handshake`,n.loggingMetadata),this.onConnClosed(n)},onHandshake:e=>{this.onHandshakeResponse(n,e)},onInvalidHandshake:(t,i)=>{this.log?.error(`invalid handshake: ${t}`,n.loggingMetadata),this.deleteSession(e,{unhealthy:!0}),this.protocolError({type:P.HandshakeFailed,code:i,message:t})},onHandshakeTimeout:()=>{this.log?.error(`connection to ${n.to} timed out during handshake`,n.loggingMetadata),this.onConnClosed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});return this.updateSession(n),this.sendHandshake(n),n}rejectHandshakeResponse(e,t,n){e.conn.telemetry?.span.setStatus({code:h.s.ERROR,message:t}),this.log?.warn(t,n),this.deleteSession(e,{unhealthy:!0})}onHandshakeResponse(e,t){if(!D.J(c.O9,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",{...e.loggingMetadata,transportMessage:t,validationErrors:[...R.I(c.O9,t.payload)]});if(!t.payload.status.ok){let n=D.J(c.Bi,t.payload.status.code),i=`handshake failed: ${t.payload.status.reason}`,s=e.to;this.rejectHandshakeResponse(e,i,{...e.loggingMetadata,transportMessage:t}),n?this.tryReconnecting(s):this.protocolError({type:P.HandshakeFailed,code:t.payload.status.code,message:i});return}if(t.payload.status.sessionId!==e.id){let n=`session id mismatch: expected ${e.id}, got ${t.payload.status.sessionId}`;this.rejectHandshakeResponse(e,n,{...e.loggingMetadata,transportMessage:t});return}this.log?.info(`handshake from ${t.from} ok`,{...e.loggingMetadata,transportMessage:t});let n=eh.transition.HandshakingToConnected(e,{onConnectionErrored:e=>{let t=(0,c.xH)(e);e instanceof Error&&this.options.isFatalConnectionError(e)?(this.log?.warn(`connection to ${n.to} fatally errored: ${t}`,n.loggingMetadata),this.reconnectOnConnectionDrop=!1):this.log?.warn(`connection to ${n.to} errored: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.info(`connection to ${n.to} closed`,n.loggingMetadata),this.onConnClosed(n)},onMessage:e=>{this.handleMsg(e)},onInvalidMessage:e=>{this.log?.error(`invalid message: ${e}`,{...n.loggingMetadata,transportMessage:t}),this.protocolError({type:P.InvalidMessage,message:e}),this.deleteSession(n,{unhealthy:!0})},onMessageSendFailure:(e,t)=>{this.log?.error(`failed to send message: ${t}`,{...n.loggingMetadata,transportMessage:e}),this.protocolError({type:P.MessageSendFailure,message:t}),this.deleteSession(n,{unhealthy:!0})}});n.sendBufferedMessages().ok&&(this.updateSession(n),this.retryBudget.startRestoringBudget())}connect(e){if("open"!==this.getStatus())return void this.log?.info(`transport state is no longer open, cancelling attempt to connect to ${e}`);let t=this.sessions.get(e)??this.createUnconnectedSession(e);if("NoConnection"!==t.state)return void this.log?.debug(`session to ${e} has state ${t.state}, skipping connect attempt`,t.loggingMetadata);if(!this.retryBudget.hasBudget()){let n=this.retryBudget.getBudgetConsumed(),i=`tried to connect to ${e} but retry budget exceeded (more than ${n} attempts in the last ${this.retryBudget.totalBudgetRestoreTime}ms)`;this.log?.error(i,t.loggingMetadata),this.protocolError({type:P.RetriesExceeded,message:i});return}let n=this.retryBudget.getBackoffMs();this.log?.info(`attempting connection to ${e} (${n}ms backoff)`,t.loggingMetadata),this.retryBudget.consumeBudget();let i=eh.transition.NoConnectionToBackingOff(t,n,{onBackoffFinished:()=>{this.onBackoffFinished(i)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(i)}});this.updateSession(i)}hardDisconnect(){for(let e of Array.from(this.sessions.values()))this.deleteSession(e)}onBackoffFinished(e){let t=e.tracer.startActiveSpan("connect",async t=>{try{return await this.createNewOutgoingConnection(e.to)}catch(n){let e=(0,c.xH)(n);throw t.recordException(e),t.setStatus({code:h.s.ERROR}),n}finally{t.end()}}),n=eh.transition.BackingOffToConnecting(e,t,{onConnectionEstablished:e=>{this.log?.debug(`connection to ${n.to} established`,{...e.loggingMetadata,...n.loggingMetadata}),this.onConnectionEstablished(n,e)},onConnectionFailed:e=>{let t=(0,c.xH)(e);this.log?.error(`error connecting to ${n.to}: ${t}`,n.loggingMetadata),this.onConnectingFailed(n)},onConnectionTimeout:()=>{this.log?.error(`connection to ${n.to} timed out`,n.loggingMetadata),this.onConnectingFailed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});this.updateSession(n)}async sendHandshake(e){let t;if(this.handshakeExtensions&&(t=await this.handshakeExtensions.construct()),e._isConsumed)return;let n=(0,c.sE)({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:t,tracing:(0,c.oG)(e.telemetry.ctx)});this.log?.debug(`sending handshake request to ${e.to}`,{...e.loggingMetadata,transportMessage:n});let i=e.sendHandshake(n);i.ok||(this.log?.error(`failed to send handshake request: ${i.reason}`,{...e.loggingMetadata,transportMessage:n}),this.protocolError({type:P.MessageSendFailure,message:i.reason}),this.deleteSession(e,{unhealthy:!0}))}close(){this.retryBudget.close(),super.close()}},ep=class{id;telemetry;constructor(){this.id=`conn-${(0,c.$C)()}`}get loggingMetadata(){let e={connId:this.id};if(this.telemetry?.span.isRecording()){let t=this.telemetry.span.spanContext();e.telemetry={traceId:t.traceId,spanId:t.spanId}}return e}dataListener;closeListener;errorListener;onData(e){this.dataListener?.(e)}onError(e){this.errorListener?.(e)}onClose(){this.closeListener?.(),this.telemetry?.span.end()}setDataListener(e){this.dataListener=e}removeDataListener(){this.dataListener=void 0}setCloseListener(e){this.closeListener=e}removeCloseListener(){this.closeListener=void 0}setErrorListener(e){this.errorListener=e}removeErrorListener(){this.errorListener=void 0}},eg=class extends Error{code;reason;constructor(e,t){super(`websocket closed with code and reason: ${e} - ${t}`),this.code=e,this.reason=t}},ey=class extends ep{ws;extras;get loggingMetadata(){let e=super.loggingMetadata;return this.extras&&(e.extras=this.extras),e}constructor(e,t){super(),this.ws=e,this.extras=t,this.ws.binaryType="arraybuffer";let n=!1;this.ws.onerror=()=>{n=!0},this.ws.onclose=({code:e,reason:t})=>{if(n){let n=new eg(e,t);this.onError(n)}this.onClose()},this.ws.onmessage=e=>{this.onData(e.data)}}send(e){try{return this.ws.send(e),!0}catch{return!1}}close(){this.ws.close(1e3)}}},36641:(e,t,n)=>{"use strict";n.d(t,{M:()=>B});var i=new TextEncoder;function s(e,t,n){for(var i=t,s=i+n,r=[],o="";i<s;){var a=e[i++];if((128&a)==0)r.push(a);else if((224&a)==192){var l=63&e[i++];r.push((31&a)<<6|l)}else if((240&a)==224){var l=63&e[i++],c=63&e[i++];r.push((31&a)<<12|l<<6|c)}else if((248&a)==240){var l=63&e[i++],c=63&e[i++],h=(7&a)<<18|l<<12|c<<6|63&e[i++];h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h)}else r.push(a);r.length>=4096&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return r.length>0&&(o+=String.fromCharCode.apply(String,r)),o}var r=new TextDecoder,o=function(e,t){this.type=e,this.data=t},a=function(){var e=function(t,n){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),l=function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,Object.create(t.prototype)),Object.defineProperty(i,"name",{configurable:!0,enumerable:!1,value:t.name}),i}return a(t,e),t}(Error);function c(e,t,n){var i=Math.floor(n/0x100000000);e.setUint32(t,i),e.setUint32(t+4,n)}function h(e,t){return 0x100000000*e.getInt32(t)+e.getUint32(t+4)}var u={type:-1,encode:function(e){var t,n,i,s;return e instanceof Date?function(e){var t=e.sec,n=e.nsec;if(t>=0&&n>=0&&t<=0x3ffffffff)if(0===n&&t<=0xffffffff){var i=new Uint8Array(4),s=new DataView(i.buffer);return s.setUint32(0,t),i}else{var r=t/0x100000000,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,n<<2|3&r),s.setUint32(4,0|t),i}var i=new Uint8Array(12),s=new DataView(i.buffer);return s.setUint32(0,n),c(s,4,t),i}((n=Math.floor((t=e.getTime())/1e3),s=Math.floor((i=(t-1e3*n)*1e6)/1e9),{sec:n+s,nsec:i-1e9*s})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:var n=t.getUint32(0),i=0;return{sec:n,nsec:0};case 8:var s=t.getUint32(0),n=(3&s)*0x100000000+t.getUint32(4),i=s>>>2;return{sec:n,nsec:i};case 12:var n=h(t,4),i=t.getUint32(0);return{sec:n,nsec:i};default:throw new l("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},d=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(u)}return e.prototype.register=function(e){var t=e.type,n=e.encode,i=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=i;else{var s=1+t;this.builtInEncoders[s]=n,this.builtInDecoders[s]=i}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++){var i=this.builtInEncoders[n];if(null!=i){var s=i(e,t);if(null!=s){var r=-1-n;return new o(r,s)}}}for(var n=0;n<this.encoders.length;n++){var i=this.encoders[n];if(null!=i){var s=i(e,t);if(null!=s){var r=n;return new o(r,s)}}}return e instanceof o?e:null},e.prototype.decode=function(e,t,n){var i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,n):new o(t,e)},e.defaultCodec=new e,e}();function f(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}var p=function(){function e(e){var t,n,i,s,r,o,a,l;this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:d.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxDepth=null!=(i=null==e?void 0:e.maxDepth)?i:100,this.initialBufferSize=null!=(s=null==e?void 0:e.initialBufferSize)?s:2048,this.sortKeys=null!=(r=null==e?void 0:e.sortKeys)&&r,this.forceFloat32=null!=(o=null==e?void 0:e.forceFloat32)&&o,this.ignoreUndefined=null!=(a=null==e?void 0:e.ignoreUndefined)&&a,this.forceIntegerToFloat=null!=(l=null==e?void 0:e.forceIntegerToFloat)&&l,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),i=new DataView(t);n.set(this.bytes),this.view=i,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<0x100000000?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-0x80000000?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},e.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<0x100000000)this.writeU8(219),this.writeU32(e);else throw Error("Too long string: ".concat(e," bytes in UTF-8"))},e.prototype.encodeString=function(e){var t=function(e){for(var t=e.length,n=0,i=0;i<t;){var s=e.charCodeAt(i++);if((0xffffff80&s)==0){n++;continue}if((0xfffff800&s)==0)n+=2;else{if(s>=55296&&s<=56319&&i<t){var r=e.charCodeAt(i);(64512&r)==56320&&(++i,s=((1023&s)<<10)+(1023&r)+65536)}(0xffff0000&s)==0?n+=3:n+=4}}return n}(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,n){if(e.length>50)i.encodeInto(e,t.subarray(n));else!function(e,t,n){for(var i=e.length,s=n,r=0;r<i;){var o=e.charCodeAt(r++);if((0xffffff80&o)==0){t[s++]=o;continue}if((0xfffff800&o)==0)t[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&r<i){var a=e.charCodeAt(r);(64512&a)==56320&&(++r,o=((1023&o)<<10)+(1023&a)+65536)}(0xffff0000&o)==0?t[s++]=o>>12&15|224:(t[s++]=o>>18&7|240,t[s++]=o>>12&63|128),t[s++]=o>>6&63|128}t[s++]=63&o|128}}(e,t,n)}(e,this.bytes,this.pos),this.pos+=t},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<0x100000000)this.writeU8(198),this.writeU32(t);else throw Error("Too large binary: ".concat(t));var n=f(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<0x100000000)this.writeU8(221),this.writeU32(n);else throw Error("Too large array: ".concat(n));for(var i=0;i<e.length;i++){var s=e[i];this.doEncode(s,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var n=0,i=0;i<t.length;i++)void 0!==e[t[i]]&&n++;return n},e.prototype.encodeMap=function(e,t){var n=Object.keys(e);this.sortKeys&&n.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<0x100000000)this.writeU8(223),this.writeU32(i);else throw Error("Too large map object: ".concat(i));for(var s=0;s<n.length;s++){var r=n[s],o=e[r];this.ignoreUndefined&&void 0===o||(this.encodeString(r),this.doEncode(o,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<0x100000000)this.writeU8(201),this.writeU32(t);else throw Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){var t,n;this.ensureBufferSizeToWrite(8),t=this.view,n=this.pos,t.setUint32(n,e/0x100000000),t.setUint32(n+4,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),c(this.view,this.pos,e),this.pos+=8},e.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},e.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},e}();function g(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var y=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){var i=this.caches[n-1];e:for(var s=0;s<i.length;s++){for(var r=i[s],o=r.bytes,a=0;a<n;a++)if(o[a]!==e[t+a])continue e;return r.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],i={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)},e.prototype.decode=function(e,t,n){var i=this.find(e,t,n);if(null!=i)return this.hit++,i;this.miss++;var r=s(e,t,n),o=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(o,r),r},e}(),m=function(e,t){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){var c=[a,l];if(n)throw TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,i&&(s=2&c[0]?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[2&c[0],s.value]),c[0]){case 0:case 1:s=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,i=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3])){o.label=c[1];break}if(6===c[0]&&o.label<s[1]){o.label=s[1],s=c;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(c);break}s[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],i=0}finally{n=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},v=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,s){var r,o,a;r=i,o=s,a=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){r({value:e,done:a})},o)})}}},w=function(e){return this instanceof w?(this.v=e,this):new w(e)},b=function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,s=n.apply(e,t||[]),r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){s[e]&&(i[e]=function(t){return new Promise(function(n,i){r.push([e,t,n,i])>1||a(e,t)})})}function a(e,t){try{var n;(n=s[e](t)).value instanceof w?Promise.resolve(n.value.v).then(l,c):h(r[0][2],n)}catch(e){h(r[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function h(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}},x="array",E="map_key",S=new DataView(new ArrayBuffer(0)),k=new Uint8Array(S.buffer);try{S.getInt8(0)}catch(e){if(!(e instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var _=RangeError,C=new _("Insufficient data"),U=new y,M=function(){function e(e){var t,n,i,s,r,o,a;this.totalPos=0,this.pos=0,this.view=S,this.bytes=k,this.headByte=-1,this.stack=[],this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:d.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxStrLength=null!=(i=null==e?void 0:e.maxStrLength)?i:0xffffffff,this.maxBinLength=null!=(s=null==e?void 0:e.maxBinLength)?s:0xffffffff,this.maxArrayLength=null!=(r=null==e?void 0:e.maxArrayLength)?r:0xffffffff,this.maxMapLength=null!=(o=null==e?void 0:e.maxMapLength)?o:0xffffffff,this.maxExtLength=null!=(a=null==e?void 0:e.maxExtLength)?a:0xffffffff,this.keyDecoder=(null==e?void 0:e.keyDecoder)!==void 0?e.keyDecoder:U}return e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=f(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=f(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=f(e),i=new Uint8Array(t.length+n.length);i.set(t),i.set(n,t.length),this.setBuffer(i)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return m(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return t.sent(),[3,1];case 3:return[2]}})},e.prototype.decodeAsync=function(e){var t,n,i,s,r,o,a,l,c,h,u;return l=this,c=void 0,h=void 0,u=function(){var l,c,h,u,d,f,p;return m(this,function(y){switch(y.label){case 0:l=!1,y.label=1;case 1:y.trys.push([1,6,7,12]),t=!0,n=v(e),y.label=2;case 2:return[4,n.next()];case 3:if(s=(i=y.sent()).done)return[3,5];a=i.value,t=!1;try{if(h=a,l)throw this.createExtraByteError(this.totalPos);this.appendBuffer(h);try{c=this.doDecodeSync(),l=!0}catch(e){if(!(e instanceof _))throw e}this.totalPos+=this.pos}finally{t=!0}y.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return r={error:y.sent()},[3,12];case 7:if(y.trys.push([7,,10,11]),!(!t&&!s&&(o=n.return)))return[3,9];return[4,o.call(n)];case 8:y.sent(),y.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(l){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,c]}throw u=this,d=u.headByte,f=u.pos,p=u.totalPos,RangeError("Insufficient data in parsing ".concat(g(d)," at ").concat(p," (").concat(f," in the current buffer)"))}})},new(h||(h=Promise))(function(e,t){function n(e){try{s(u.next(e))}catch(e){t(e)}}function i(e){try{s(u.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):((s=t.value)instanceof h?s:new h(function(e){e(s)})).then(n,i)}s((u=u.apply(l,c||[])).next())})},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return b(this,arguments,function(){var n,i,s,r,o,a,l,c,h,u,d;return m(this,function(f){switch(f.label){case 0:n=t,i=-1,f.label=1;case 1:f.trys.push([1,15,16,21]),s=!0,r=v(e),f.label=2;case 2:return[4,w(r.next())];case 3:if(c=(o=f.sent()).done)return[3,14];d=o.value,s=!1,f.label=4;case 4:if(f.trys.push([4,,12,13]),a=d,t&&0===i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),n&&(i=this.readArraySize(),n=!1,this.complete()),f.label=5;case 5:f.trys.push([5,10,,11]),f.label=6;case 6:return[4,w(this.doDecodeSync())];case 7:return[4,f.sent()];case 8:if(f.sent(),0==--i)return[3,9];return[3,6];case 9:return[3,11];case 10:if(!((l=f.sent())instanceof _))throw l;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return s=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return h={error:f.sent()},[3,21];case 16:if(f.trys.push([16,,19,20]),!(!s&&!c&&(u=r.return)))return[3,18];return[4,w(u.call(r))];case 17:f.sent(),f.label=18;case 18:return[3,20];case 19:if(h)throw h.error;return[7];case 20:return[7];case 21:return[2]}})})},e.prototype.doDecodeSync=function(){t:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var n=e-128;if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(e<160){var n=e-144;if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else{var i=e-160;t=this.decodeUtf8String(i,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===e){var i=this.lookU8();t=this.decodeUtf8String(i,1)}else if(218===e){var i=this.lookU16();t=this.decodeUtf8String(i,2)}else if(219===e){var i=this.lookU32();t=this.decodeUtf8String(i,4)}else if(220===e){var n=this.readU16();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(221===e){var n=this.readU32();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(222===e){var n=this.readU16();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(223===e){var n=this.readU32();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(196===e){var n=this.lookU8();t=this.decodeBinary(n,1)}else if(197===e){var n=this.lookU16();t=this.decodeBinary(n,2)}else if(198===e){var n=this.lookU32();t=this.decodeBinary(n,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){var n=this.lookU8();t=this.decodeExtension(n,1)}else if(200===e){var n=this.lookU16();t=this.decodeExtension(n,2)}else if(201===e){var n=this.lookU32();t=this.decodeExtension(n,4)}else throw new l("Unrecognized type byte: ".concat(g(e)));this.complete();for(var s=this.stack;s.length>0;){var r,o=s[s.length-1];if(o.type===x)if(o.array[o.position]=t,o.position++,o.position===o.size)s.pop(),t=o.array;else continue t;else if(o.type===E){if("string"!=typeof(r=t)&&"number"!=typeof r)throw new l("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new l("The key __proto__ is not allowed");o.key=t,o.type="map_value";continue t}else if(o.map[o.key]=t,o.readCount++,o.readCount===o.size)s.pop(),t=o.map;else{o.key=null,o.type=E;continue t}}return t}},e.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new l("Unrecognized array type byte: ".concat(g(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new l("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:E,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new l("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:x,size:e,array:Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){if(e>this.maxStrLength)throw new l("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw C;var n,i,o=this.pos+t;return i=this.stateIsMapKey()&&(null==(n=this.keyDecoder)?void 0:n.canBeCached(e))?this.keyDecoder.decode(this.bytes,o,e):function(e,t,n){var i;return n>200?(i=e.subarray(t,t+n),r.decode(i)):s(e,t,n)}(this.bytes,o,e),this.pos+=t+e,i},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===E},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new l("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw C;var n=this.pos+t,i=this.bytes.subarray(n,n+e);return this.pos+=t+e,i},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new l("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,n=(e=this.view,t=this.pos,0x100000000*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n},e.prototype.readI64=function(){var e=h(this.view,this.pos);return this.pos+=8,e},e.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},e.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}(),B={toBuffer:e=>new p({ignoreUndefined:!0}).encodeSharedRef(e),fromBuffer:e=>{try{let t=new M(void 0).decode(e);if("object"!=typeof t)return null;return t}catch{return null}}}},37328:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,i.default)(e),!e||/[\s<>]/.test(e)||0===e.indexOf("mailto:")||(t=(0,o.default)(t,c)).validate_length&&e.length>=2083||!t.allow_fragments&&e.includes("#")||!t.allow_query_components&&(e.includes("?")||e.includes("&")))return!1;if((m=(e=(m=(e=(m=e.split("#")).shift()).split("?")).shift()).split("://")).length>1){if(a=m.shift().toLowerCase(),t.require_valid_protocol&&-1===t.protocols.indexOf(a))return!1}else if(t.require_protocol)return!1;else if("//"===e.slice(0,2)){if(!t.allow_protocol_relative_urls)return!1;m[0]=e.slice(2)}if(""===(e=m.join("://")))return!1;if(""===(e=(m=e.split("/")).shift())&&!t.require_host)return!0;if((m=e.split("@")).length>1){if(t.disallow_auth||""===m[0]||(d=m.shift()).indexOf(":")>=0&&d.split(":").length>2)return!1;var n,a,d,f,p,g,y,m,v,w=function(e){if(Array.isArray(e))return e}(n=d.split(":"))||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),n.length!==t);i=!0);}catch(e){s=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw r}}return n}}(n,2)||function(e,t){if(e){if("string"==typeof e)return l(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(n,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),b=w[0],x=w[1];if(""===b&&""===x)return!1}p=m.join("@"),y=null,v=null;var E=p.match(h);if(E?(f="",v=E[1],y=E[2]||null):(f=(m=p.split(":")).shift(),m.length&&(y=m.join(":"))),null!==y&&y.length>0){if(g=parseInt(y,10),!/^[0-9]+$/.test(y)||g<=0||g>65535)return!1}else if(t.require_port)return!1;return t.host_whitelist?u(f,t.host_whitelist):""===f&&!t.require_host||(!!(0,r.default)(f)||!!(0,s.default)(f,t)||!!v&&!!(0,r.default)(v,6))&&(f=f||v,!(t.host_blacklist&&u(f,t.host_blacklist)))};var i=a(n(6235)),s=a(n(69696)),r=a(n(9550)),o=a(n(29588));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var c={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,allow_fragments:!0,allow_query_components:!0,validate_length:!0},h=/^\[([^\]]+)\](?::([0-9]+))?$/;function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(e===i||"[object RegExp]"===Object.prototype.toString.call(i)&&i.test(e))return!0}return!1}e.exports=t.default,e.exports.default=t.default},37591:(e,t,n)=>{"use strict";n.d(t,{Ng:()=>d,bd:()=>c,oK:()=>u}),n(95570);var i={debug:-1,info:0,warn:1,error:2},s=e=>(t,n)=>{if(!n?.transportMessage)return void e(t,n);let{payload:i,...s}=n.transportMessage;n.transportMessage=s,e(t,n)},r=class{minLevel;output;constructor(e,t="info"){this.minLevel=t,this.output=e}debug(e,t){i[this.minLevel]<=i.debug&&this.output(e,t??{},"debug")}info(e,t){i[this.minLevel]<=i.info&&this.output(e,t??{},"info")}warn(e,t){i[this.minLevel]<=i.warn&&this.output(e,t??{},"warn")}error(e,t){i[this.minLevel]<=i.error&&this.output(e,t??{},"error")}},o=e=>({debug:s(e.debug.bind(e)),info:s(e.info.bind(e)),warn:s(e.warn.bind(e)),error:s(e.error.bind(e))}),a=n(38325),l=n(48055),c={RetriesExceeded:"conn_retry_exceeded",HandshakeFailed:"handshake_failed",MessageOrderingViolated:"message_ordering_violated",InvalidMessage:"invalid_message"},h=class{eventListeners={};removeAllListeners(){this.eventListeners={}}numberOfListeners(e){return this.eventListeners[e]?.size??0}addEventListener(e,t){this.eventListeners[e]||(this.eventListeners[e]=new Set),this.eventListeners[e]?.add(t)}removeEventListener(e,t){this.eventListeners[e]&&this.eventListeners[e]?.delete(t)}dispatchEvent(e,t){let n=this.eventListeners[e];if(n)for(let e of[...n])e(t)}},u=class{status;clientId;eventDispatcher;options;log;sessions;constructor(e,t){this.options={...a.jw,...t},this.eventDispatcher=new h,this.clientId=e,this.status="open",this.sessions=new Map}bindLogger(e,t){if("function"==typeof e){this.log=o(new r(e,t));return}this.log=o(e)}handleMsg(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}addEventListener(e,t){this.eventDispatcher.addEventListener(e,t)}removeEventListener(e,t){this.eventDispatcher.removeEventListener(e,t)}protocolError(e){this.eventDispatcher.dispatchEvent("protocolError",e)}close(){for(let e of(this.status="closed",this.sessions.values()))this.deleteSession(e);this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),this.log?.info("manually closed transport",{clientId:this.clientId})}getStatus(){return this.status}updateSession(e){let t=this.sessions.get(e.to);if(t&&t.id!==e.id)throw Error(`attempt to transition active session for ${e.to} but active session (${t.id}) is different from handle (${e.id})`);return this.sessions.set(e.to,e),t||this.eventDispatcher.dispatchEvent("sessionStatus",{status:"connect",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,session:e}),e}deleteSession(e,t){if(e._isConsumed)return;let n=e.loggingMetadata;n.tags&&t?.unhealthy&&n.tags.push("unhealthy-session"),e.log?.info(`closing session ${e.id}`,n),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"disconnect",session:e});let i=e.to;e.close(),this.sessions.delete(i)}onSessionGracePeriodElapsed(e){this.log?.warn(`session to ${e.to} grace period elapsed, closing`,e.loggingMetadata),this.deleteSession(e)}onConnectingFailed(e){let t=a.CC.transition.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}});return this.updateSession(t)}onConnClosed(e){let t;return t="Handshaking"===e.state?a.CC.transition.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}):a.CC.transition.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}),this.updateSession(t)}},d=class{id;telemetry;constructor(){this.id=`conn-${(0,l.$C)()}`}get loggingMetadata(){let e={connId:this.id},t=this.telemetry?.span.spanContext();return this.telemetry?.span.isRecording()&&t&&(e.telemetry={traceId:t.traceId,spanId:t.spanId}),e}_dataListeners=new Set;_closeListeners=new Set;_errorListeners=new Set;get dataListeners(){return[...this._dataListeners]}get closeListeners(){return[...this._closeListeners]}get errorListeners(){return[...this._errorListeners]}addDataListener(e){this._dataListeners.add(e)}removeDataListener(e){this._dataListeners.delete(e)}addCloseListener(e){this._closeListeners.add(e)}removeCloseListener(e){this._closeListeners.delete(e)}addErrorListener(e){this._errorListeners.add(e)}removeErrorListener(e){this._errorListeners.delete(e)}}},38325:(e,t,n)=>{"use strict";n.d(t,{Dl:()=>M,CC:()=>C,I$:()=>u,jw:()=>h});var i=n(48055),s=new TextEncoder,r=new TextDecoder,o=n(97858),a=n(16128),l=n(63650),c=n(64254).hp,h={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:e=>s.encode(JSON.stringify(e,function(e){let t,n=this[e];if(!(n instanceof Uint8Array))return n;return{$t:(t="",n.forEach(e=>{t+=String.fromCharCode(e)}),btoa(t))}})),fromBuffer:e=>{try{let t=JSON.parse(r.decode(e),function(e,t){return t?.$t?function(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(t.$t):t});if("object"==typeof t)return t;return null}catch{return null}}}},u={...h,baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200};({...h});var d=(e=>(e.NoConnection="NoConnection",e.BackingOff="BackingOff",e.Connecting="Connecting",e.Handshaking="Handshaking",e.Connected="Connected",e.WaitingForHandshake="WaitingForHandshake",e))(d||{}),f="session state has been consumed and is no longer valid",p=class{_isConsumed;close(){this._handleClose()}constructor(){return this._isConsumed=!1,new Proxy(this,{get(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return()=>{e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return()=>{e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error(`${f}: getting ${t.toString()} on consumed state`);return Reflect.get(e,t)},set(e,t,n){if(e._isConsumed)throw Error(`${f}: setting ${t.toString()} on consumed state`);return Reflect.set(e,t,n)}})}},g=class extends p{from;options;log;constructor({from:e,options:t,log:n}){super(),this.from=e,this.options=t,this.log=n}parseMsg(e){let t=this.options.codec.fromBuffer(e);if(null===t){let t=new TextDecoder().decode(c.from(e));return this.log?.error(`received malformed msg: ${t}`,this.loggingMetadata),null}return o.J(i.bH,t)?t:(this.log?.error(`received invalid msg: ${JSON.stringify(t)}`,{...this.loggingMetadata,validationErrors:[...a.I(i.bH,t)]}),null)}},y=class extends g{id;telemetry;to;seq;ack;sendBuffer;constructor(e){let{id:t,to:n,seq:i,ack:s,sendBuffer:r,telemetry:o,log:a}=e;super(e),this.id=t,this.to=n,this.seq=i,this.ack=s,this.sendBuffer=r,this.telemetry=o,this.log=a}get loggingMetadata(){let e=this.telemetry.span.spanContext(),t={clientId:this.from,connectedTo:this.to,sessionId:this.id};return this.telemetry.span.isRecording()&&(t.telemetry={traceId:e.traceId,spanId:e.spanId}),t}constructMsg(e){let t={...e,id:(0,i.$C)(),to:this.to,from:this.from,seq:this.seq,ack:this.ack};return this.seq++,t}nextSeq(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}send(e){let t=this.constructMsg(e);return this.sendBuffer.push(t),t.id}_handleStateExit(){}_handleClose(){this.sendBuffer.length=0,this.telemetry.span.end()}},m=class extends y{graceExpiryTime;gracePeriodTimeout;listeners;constructor(e){super(e),this.listeners=e.listeners,this.graceExpiryTime=e.graceExpiryTime,this.gracePeriodTimeout=setTimeout(()=>{this.listeners.onSessionGracePeriodElapsed()},this.graceExpiryTime-Date.now())}_handleStateExit(){super._handleStateExit(),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}_handleClose(){super._handleClose()}},v=class extends m{state="Connecting";connPromise;listeners;connectionTimeout;constructor(e){super(e),this.connPromise=e.connPromise,this.listeners=e.listeners,this.connPromise.then(e=>{this._isConsumed||this.listeners.onConnectionEstablished(e)},e=>{this._isConsumed||this.listeners.onConnectionFailed(e)}),this.connectionTimeout=setTimeout(()=>{this.listeners.onConnectionTimeout()},this.options.connectionTimeoutMs)}bestEffortClose(){let e=this.log,t=this.loggingMetadata;this.connPromise.then(n=>{n.close(),e?.info("connection eventually resolved but session has transitioned, closed connection",{...t,...n.loggingMetadata})}).catch(()=>{})}_handleStateExit(){super._handleStateExit(),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}_handleClose(){this.bestEffortClose(),super._handleClose()}},w=class extends m{state="NoConnection";_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit()}},b=class extends g{state="WaitingForHandshake";conn;listeners;handshakeTimeout;constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.handshakeTimeout=setTimeout(()=>{this.listeners.onHandshakeTimeout()},this.options.handshakeTimeoutMs),this.conn.addDataListener(this.onHandshakeData),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.conn.addCloseListener(this.listeners.onConnectionClosed)}get loggingMetadata(){return{clientId:this.from,connId:this.conn.id,...this.conn.loggingMetadata}}onHandshakeData=e=>{let t=this.parseMsg(e);if(null===t)return void this.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE");this.listeners.onHandshake(t)};sendHandshake(e){return this.conn.send(this.options.codec.toBuffer(e))}_handleStateExit(){this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0}_handleClose(){this.conn.close()}},x=class extends m{state="Handshaking";conn;listeners;handshakeTimeout;constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.handshakeTimeout=setTimeout(()=>{this.listeners.onHandshakeTimeout()},this.options.handshakeTimeoutMs),this.conn.addDataListener(this.onHandshakeData),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.conn.addCloseListener(this.listeners.onConnectionClosed)}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}onHandshakeData=e=>{let t=this.parseMsg(e);if(null===t)return void this.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE");this.listeners.onHandshake(t)};sendHandshake(e){return this.conn.send(this.options.codec.toBuffer(e))}_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},E=class extends y{state="Connected";conn;listeners;heartbeatHandle;heartbeatMisses=0;isActivelyHeartbeating;updateBookkeeping(e,t){this.sendBuffer=this.sendBuffer.filter(t=>t.seq>=e),this.ack=t+1,this.heartbeatMisses=0}send(e){let t=this.constructMsg(e);return this.sendBuffer.push(t),this.conn.send(this.options.codec.toBuffer(t)),t.id}constructor(e){if(super(e),this.conn=e.conn,this.listeners=e.listeners,this.conn.addDataListener(this.onMessageData),this.conn.addCloseListener(this.listeners.onConnectionClosed),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.sendBuffer.length>0)for(let e of(this.log?.info(`sending ${this.sendBuffer.length} buffered messages, starting at seq ${this.nextSeq()}`,this.loggingMetadata),this.sendBuffer))this.conn.send(this.options.codec.toBuffer(e));this.isActivelyHeartbeating=!1,this.heartbeatHandle=setInterval(()=>{let e=this.heartbeatMisses,t=e*this.options.heartbeatIntervalMs;if(e>=this.options.heartbeatsUntilDead){this.log?.info(`closing connection to ${this.to} due to inactivity (missed ${e} heartbeats which is ${t}ms)`,this.loggingMetadata),this.telemetry.span.addEvent("closing connection due to inactivity"),this.conn.close(),clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0;return}this.isActivelyHeartbeating&&this.sendHeartbeat(),this.heartbeatMisses++},this.options.heartbeatIntervalMs)}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}startActiveHeartbeat(){this.isActivelyHeartbeating=!0}sendHeartbeat(){this.log?.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}closeConnection(){this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.close()}onMessageData=e=>{let t=this.parseMsg(e);if(null===t)return void this.listeners.onInvalidMessage("could not parse message");if(t.seq!==this.ack){if(t.seq<this.ack)this.log?.debug(`received duplicate msg (got seq: ${t.seq}, wanted seq: ${this.ack}), discarding`,{...this.loggingMetadata,transportMessage:t});else{let e=`received out-of-order msg, closing connection (got seq: ${t.seq}, wanted seq: ${this.ack})`;this.log?.warn(e,{...this.loggingMetadata,transportMessage:t,tags:["invariant-violation"]}),this.telemetry.span.setStatus({code:l.s.ERROR,message:e}),this.closeConnection()}return}if(this.log?.debug("received msg",{...this.loggingMetadata,transportMessage:t}),this.updateBookkeeping(t.ack,t.seq),!(0,i.o0)(t.controlFlags))return void this.listeners.onMessage(t);this.log?.debug("discarding msg (ack bit set)",{...this.loggingMetadata,transportMessage:t}),this.isActivelyHeartbeating||this.sendHeartbeat()};_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},S=class extends m{state="BackingOff";listeners;backoffTimeout;constructor(e){super(e),this.listeners=e.listeners,this.backoffTimeout=setTimeout(()=>{this.listeners.onBackoffFinished()},e.backoffMs)}_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit(),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}};function k(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log}}function _(e){return{...k(e),graceExpiryTime:e.graceExpiryTime}}var C={entrypoints:{NoConnection:(e,t,n,s,r)=>{let o=`session-${(0,i.$C)()}`,a=(0,i.iH)(o,e,t),l=new w({listeners:n,id:o,from:t,to:e,seq:0,ack:0,graceExpiryTime:Date.now()+s.sessionDisconnectGraceMs,sendBuffer:[],telemetry:a,options:s,log:r});return l.log?.info(`session ${l.id} created in NoConnection state`,{...l.loggingMetadata,tags:["state-transition"]}),l},WaitingForHandshake:(e,t,n,i,s)=>{let r=new b({conn:t,listeners:n,from:e,options:i,log:s});return r.log?.info("session created in WaitingForHandshake state",{...r.loggingMetadata,tags:["state-transition"]}),r}},transition:{NoConnectionToBackingOff:(e,t,n)=>{let i=_(e);e._handleStateExit();let s=new S({backoffMs:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from NoConnection to BackingOff`,{...s.loggingMetadata,tags:["state-transition"]}),s},BackingOffToConnecting:(e,t,n)=>{let i=_(e);e._handleStateExit();let s=new v({connPromise:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from BackingOff to Connecting`,{...s.loggingMetadata,tags:["state-transition"]}),s},ConnectingToHandshaking:(e,t,n)=>{let i=_(e);e._handleStateExit();let s=new x({conn:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from Connecting to Handshaking`,{...s.loggingMetadata,tags:["state-transition"]}),s},HandshakingToConnected:(e,t)=>{let n=k(e),i=e.conn;e._handleStateExit();let s=new E({conn:i,listeners:t,...n});return s.log?.info(`session ${s.id} transition from Handshaking to Connected`,{...s.loggingMetadata,tags:["state-transition"]}),s},WaitingForHandshakeToConnected:(e,t,n,s,r,o)=>{let a=e.conn,{from:l,options:c}=e,h=t?k(t):{id:n,from:l,to:s,seq:0,ack:0,sendBuffer:[],telemetry:(0,i.iH)(n,s,l,r),options:c,log:e.log};e._handleStateExit(),t?._handleStateExit();let u=new E({conn:a,listeners:o,...h});return u.log?.info(`session ${u.id} transition from WaitingForHandshake to Connected`,{...u.loggingMetadata,tags:["state-transition"]}),u},BackingOffToNoConnection:(e,t)=>{let n=_(e);e._handleStateExit();let i=new w({listeners:t,...n});return i.log?.info(`session ${i.id} transition from BackingOff to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectingToNoConnection:(e,t)=>{let n=_(e);e.bestEffortClose(),e._handleStateExit();let i=new w({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Connecting to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},HandshakingToNoConnection:(e,t)=>{let n=_(e);e.conn.close(),e._handleStateExit();let i=new w({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Handshaking to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectedToNoConnection:(e,t)=>{let n=k(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();let s=new w({listeners:t,graceExpiryTime:i,...n});return s.log?.info(`session ${s.id} transition from Connected to NoConnection`,{...s.loggingMetadata,tags:["state-transition"]}),s}}},U=C.transition,M={entrypoint:C.entrypoints.NoConnection,transition:{NoConnectionToBackingOff:U.NoConnectionToBackingOff,BackingOffToConnecting:U.BackingOffToConnecting,ConnectingToHandshaking:U.ConnectingToHandshaking,HandshakingToConnected:U.HandshakingToConnected,BackingOffToNoConnection:U.BackingOffToNoConnection,ConnectingToNoConnection:U.ConnectingToNoConnection,HandshakingToNoConnection:U.HandshakingToNoConnection,ConnectedToNoConnection:U.ConnectedToNoConnection}};C.entrypoints.WaitingForHandshake,U.WaitingForHandshakeToConnected,U.ConnectedToNoConnection},42028:(e,t,n)=>{"use strict";n.d(t,{T:()=>m});var i=n(91601),s=n(80029),r=n(37609),o=n(80031),a=n(69094),l=n(83850),c=n(97858),h=n(99410),u=n(93294);class d extends r.i{constructor(e,t,n){super("Unable to decode value as it does not match the expected schema"),this.schema=e,this.value=t,this.error=n}}class f extends r.i{constructor(e,t,n,i){super(i instanceof Error?i.message:"Unknown error"),this.schema=e,this.path=t,this.value=n,this.error=i}}function p(e,t,n){try{return(0,u.n_)(e)?e[s.H7].Decode(n):n}catch(i){throw new f(e,t,n,i)}}let g=new Set;var y=n(16128);function m(...e){let[t,n,r]=3===e.length?[e[0],e[1],e[2]]:[e[0],[],e[1]];if(!(0,c.J)(t,n,r))throw new d(t,r,(0,y.I)(t,n,r).First());return(g.clear(),function e(t,n){let i=(0,l.uN)(t,n);if(t.$id&&g.has(t.$id))return!1;switch(t.$id&&g.add(t.$id),t[s.b8]){case"Array":case"AsyncIterator":case"Iterator":return(0,u.n_)(t)||e(t.items,i);case"Constructor":return(0,u.n_)(t)||e(t.returns,i)||t.parameters.some(t=>e(t,i));case"Function":return(0,u.n_)(t)||e(t.returns,i)||t.parameters.some(t=>e(t,i));case"Import":let r=globalThis.Object.getOwnPropertyNames(t.$defs).reduce((e,n)=>[...e,t.$defs[n]],[]),o=t.$defs[t.$ref];return(0,u.n_)(t)||e(o,[...r,...i]);case"Intersect":return(0,u.n_)(t)||(0,u.n_)(t.unevaluatedProperties)||t.allOf.some(t=>e(t,i));case"Not":return(0,u.n_)(t)||e(t.not,i);case"Object":return(0,u.n_)(t)||Object.values(t.properties).some(t=>e(t,i))||(0,u.Yi)(t.additionalProperties)&&e(t.additionalProperties,i);case"Promise":return(0,u.n_)(t)||e(t.item,i);case"Record":let a=Object.getOwnPropertyNames(t.patternProperties)[0],c=t.patternProperties[a];return(0,u.n_)(t)||e(c,i)||(0,u.Yi)(t.additionalProperties)&&(0,u.n_)(t.additionalProperties);case"Ref":case"This":return!!(0,u.n_)(t)||e((0,l.Lk)(t,i),i);case"Tuple":return(0,u.n_)(t)||!(0,h.R1)(t.items)&&t.items.some(t=>e(t,i));case"Union":return(0,u.n_)(t)||t.anyOf.some(t=>e(t,i));default:return(0,u.n_)(t)}}(t,n))?function e(t,n,r,d){let f=(0,l.uN)(t,n);switch(t[s.b8]){case"Array":return(0,h.QS)(d)?p(t,r,d.map((n,i)=>e(t.items,f,`${r}/${i}`,n))):p(t,r,d);case"Import":let g=globalThis.Object.values(t.$defs),y=e(t.$defs[t.$ref],[...f,...g],r,d);return p(t,r,y);case"Intersect":return function(t,n,i,s){if(!(0,h.av)(s)||(0,h.u$)(s))return p(t,i,s);let r=function(e){let t=(0,a.g)(e),n=(0,o.u$)(e,t);return t.map((e,i)=>[t[i],n[i]])}(t),l=r.map(e=>e[0]),c={...s};for(let[t,s]of r)t in c&&(c[t]=e(s,n,`${i}/${t}`,c[t]));if(!(0,u.n_)(t.unevaluatedProperties))return p(t,i,c);let d=Object.getOwnPropertyNames(c),f=t.unevaluatedProperties,g={...c};for(let e of d)l.includes(e)||(g[e]=p(f,`${i}/${e}`,g[e]));return p(t,i,g)}(t,f,r,d);case"Not":return p(t,r,e(t.not,f,r,d));case"Object":return function(t,n,s,r){if(!(0,h.av)(r))return p(t,s,r);let o=(0,a.g)(t),l={...r};for(let r of o)(0,h.LT)(l,r)&&((0,h.R1)(l[r])&&(!(0,u.R1)(t.properties[r])||i.Q.IsExactOptionalProperty(l,r))||(l[r]=e(t.properties[r],n,`${s}/${r}`,l[r])));if(!(0,u.Yi)(t.additionalProperties))return p(t,s,l);let c=Object.getOwnPropertyNames(l),d=t.additionalProperties,f={...l};for(let e of c)o.includes(e)||(f[e]=p(d,`${s}/${e}`,f[e]));return p(t,s,f)}(t,f,r,d);case"Record":return function(t,n,i,s){if(!(0,h.av)(s))return p(t,i,s);let r=Object.getOwnPropertyNames(t.patternProperties)[0],o=new RegExp(r),a={...s};for(let l of Object.getOwnPropertyNames(s))o.test(l)&&(a[l]=e(t.patternProperties[r],n,`${i}/${l}`,a[l]));if(!(0,u.Yi)(t.additionalProperties))return p(t,i,a);let l=Object.getOwnPropertyNames(a),c=t.additionalProperties,d={...a};for(let e of l)o.test(e)||(d[e]=p(c,`${i}/${e}`,d[e]));return p(t,i,d)}(t,f,r,d);case"Ref":let m=(0,l.Lk)(t,f);return p(t,r,e(m,f,r,d));case"Symbol":default:return p(t,r,d);case"This":let v=(0,l.Lk)(t,f);return p(t,r,e(v,f,r,d));case"Tuple":return(0,h.QS)(d)&&(0,h.QS)(t.items)?p(t,r,t.items.map((t,n)=>e(t,f,`${r}/${n}`,d[n]))):p(t,r,d);case"Union":for(let n of t.anyOf){if(!(0,c.J)(n,f,d))continue;let i=e(n,f,r,d);return p(t,r,i)}return p(t,r,d)}}(t,n,"",r):r}},43822:(e,t,n)=>{var i=n(82274),s=n(5446),r=n(46027);e.exports=function(e,t,n){for(var o=-1,a=t.length,l={};++o<a;){var c=t[o],h=i(e,c);n(h,c)&&s(l,r(c,e),h)}return l}},45731:(e,t,n)=>{"use strict";n.d(t,{F6:()=>w,_3:()=>f});var i=/\s/,s=/[a-zA-Z_$][a-zA-Z0-9_$]*/,r=RegExp("^"+s.source+"$"),o=/^NaN|(?:[-+]?(?:(?:Infinity)|(?:0[xX][a-fA-F0-9]+)|(?:0[bB][01]+)|(?:0[oO][0-7]+)|(?:(?:(?:[1-9]\d*|0)?\.\d+|(?:[1-9]\d*|0)\.\d*|(?:[1-9]\d*|0))(?:[E|e][+|-]?\d+)?)))/;function a(e,t){return new d(e,t).value}function l(){}var c=function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);function n(){this.constructor=i}function i(t,n,i){var s=e.call(this,t)||this;return s.pos=n,s.loc=i,s}return i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n),i}(Error),h={b:"\b",n:"\n",f:"\f",r:"\r",t:"	",v:"\v",0:"\0"},u=/^[a-fA-F0-9]+$/,d=function(){function e(e,t){if(this.str=e,this.index=0,this.onComment=t&&t.onComment||l,this.onValue=t&&t.onValue||l,this.value=this.readValue(),this.allowWhitespaceOrComment(),this.index<this.str.length)throw Error("Unexpected character '"+this.peek()+"'")}return e.prototype.allowWhitespaceOrComment=function(){for(;this.index<this.str.length&&i.test(this.str[this.index]);)this.index++;var e=this.index;if(this.eat("/")){if(this.eat("/")){var t=this.readUntil(/(?:\r\n|\n|\r)/);this.onComment({start:e,end:this.index,type:"Comment",text:t,block:!1}),this.eat("\n")}else if(this.eat("*")){var t=this.readUntil(/\*\//);this.onComment({start:e,end:this.index,type:"Comment",text:t,block:!0}),this.eat("*/",!0)}this.allowWhitespaceOrComment()}},e.prototype.error=function(e,t){void 0===t&&(t=this.index);var n=function(e,t,n){var i,s,r,o,a,l,c;if("number"==typeof n)throw Error("locate takes a { startIndex, offsetLine, offsetColumn } object as the third argument");return(void 0===(i=n)&&(i={}),s=i.offsetLine||0,r=i.offsetColumn||0,o=e.split("\n"),a=0,l=o.map(function(e,t){var n=a+e.length+1,i={start:a,end:n,line:t};return a=n,i}),c=0,function(t,n){"string"==typeof t&&(t=e.indexOf(t,n||0));for(var i,o,a,h,u=l[c],d=t>=u.end?1:-1;u;){if(i=u,o=t,i.start<=o&&o<i.end)return a=u,h=t,{line:s+a.line,column:r+h-a.start,character:h};c+=d,u=l[c]}})(t,n&&n.startIndex)}(this.str,t,{offsetLine:1});throw new c(e,t,n)},e.prototype.eat=function(e,t){return this.str.slice(this.index,this.index+e.length)===e?(this.index+=e.length,e):(t&&this.error("Expected '"+e+"' instead of '"+this.str[this.index]+"'"),null)},e.prototype.peek=function(){return this.str[this.index]},e.prototype.read=function(e){var t=e.exec(this.str.slice(this.index));return t&&0===t.index?(this.index+=t[0].length,t[0]):null},e.prototype.readUntil=function(e){this.index>=this.str.length&&this.error("Unexpected end of input");var t=this.index,n=e.exec(this.str.slice(t));if(n){var i=this.index;return this.index=i+n.index,this.str.slice(i,this.index)}return this.index=this.str.length,this.str.slice(t)},e.prototype.readArray=function(){var e=this.index;if(!this.eat("["))return null;var t={start:e,end:null,type:"ArrayExpression",elements:[]};for(this.allowWhitespaceOrComment();"]"!==this.peek()&&(t.elements.push(this.readValue()),this.allowWhitespaceOrComment(),this.eat(","));)this.allowWhitespaceOrComment();return this.eat("]")||this.error("Expected ']' instead of '"+this.str[this.index]+"'"),t.end=this.index,t},e.prototype.readBoolean=function(){var e=this.index,t=this.read(/^(true|false)/);if(t)return{start:e,end:this.index,type:"Literal",raw:t,value:"true"===t}},e.prototype.readNull=function(){var e=this.index;if(this.eat("null"))return{start:e,end:this.index,type:"Literal",raw:"null",value:null}},e.prototype.readLiteral=function(){return this.readBoolean()||this.readNumber()||this.readString()||this.readNull()},e.prototype.readNumber=function(){var e=this.index,t=this.read(o);if(t){var n=t[0],i=+("-"===n||"+"===n?t.slice(1):t);return"-"===n&&(i=-i),{start:e,end:this.index,type:"Literal",raw:t,value:i}}},e.prototype.readObject=function(){var e=this.index;if(this.eat("{")){var t={start:e,end:null,type:"ObjectExpression",properties:[]};for(this.allowWhitespaceOrComment();"}"!==this.peek()&&(t.properties.push(this.readProperty()),this.allowWhitespaceOrComment(),this.eat(","));)this.allowWhitespaceOrComment();return this.eat("}",!0),t.end=this.index,t}},e.prototype.readProperty=function(){this.allowWhitespaceOrComment();var e={start:this.index,end:null,type:"Property",key:this.readPropertyKey(),value:this.readValue()};return e.end=this.index,e},e.prototype.readIdentifier=function(){var e=this.index,t=this.read(s);if(t)return{start:e,end:this.index,type:"Identifier",name:t}},e.prototype.readPropertyKey=function(){var e=this.readString()||this.readIdentifier();return e||this.error("Bad identifier as unquoted key"),"Literal"===e.type&&(e.name=String(e.value)),this.allowWhitespaceOrComment(),this.eat(":",!0),e},e.prototype.readString=function(){var e=this.index,t=this.eat("'")||this.eat('"');if(t){for(var n=!1,i="";this.index<this.str.length;){var s=this.str[this.index++];if(n){if(n=!1,"\n"===s)continue;if("\r"===s){"\n"===this.str[this.index]&&(this.index+=1);continue}if("x"===s||"u"===s){var r=this.index,o=this.index+="x"===s?2:4,a=this.str.slice(r,o);u.test(a)||this.error("Invalid "+("x"===s?"hexadecimal":"Unicode")+" escape sequence",r),i+=String.fromCharCode(parseInt(a,16))}else i+=h[s]||s}else if("\\"===s)n=!0;else if(s===t){var o=this.index;return{start:e,end:o,type:"Literal",raw:this.str.slice(e,o),value:i}}else"\n"===s&&this.error("Bad string",this.index-1),i+=s}this.error("Unexpected end of input")}},e.prototype.readValue=function(){this.allowWhitespaceOrComment();var e=this.readArray()||this.readObject()||this.readLiteral();if(e)return this.onValue(e),e;this.error("Unexpected EOF")},e}();function f(e){return function e(t){if("Literal"===t.type)return t.value;if("ArrayExpression"===t.type)return t.elements.map(e);if("ObjectExpression"===t.type){var n={};return t.properties.forEach(function(t){n[t.key.name]=e(t.value)}),n}}(a(e))}var p={"'":"'",'"':'"',"\\":"\\","\b":"b","\f":"f","\n":"n","\r":"r","	":"t","\v":"v","\0":"0","\u2028":"u2028","\u2029":"u2029"},g=/['"\\\b\f\n\r\t\v\0\u2028\u2029]/g;function y(e,t){var n='"'===t?"'":'"';return t+e.replace(g,function(e){return e===n?e:"\\"+p[e]})+t}function m(e,t,n,i,s,o){return(r.test(e)?e:y(e,n))+": "+v(t,n,i,s,o)}function v(e,t,n,i,s){var r=typeof e;if("string"===r)return y(e,t);if("number"===r||"boolean"===r||null===e)return String(e);if(Array.isArray(e)){var o=e.map(function(e){return v(e,t,n+i,i,!0)});return s?"[\n"+(n+i)+o.join(",\n"+(n+i))+"\n"+n+"]":"[ "+o.join(", ")+" ]"}if("object"===r){var a=Object.keys(e).map(function(r){return m(r,e[r],t,n+i,i,s)});return s?"{"+(n+i)+a.join(","+(n+i))+n+"}":"{ "+a.join(", ")+" }"}throw Error("Cannot stringify "+r)}function w(e,t){var n={};n["'"]=0,n['"']=0;var s=function(e){var t=e.split("\n"),n=0,i=0,s=8;if(t.forEach(function(e){var t=/^(?: +|\t+)/.exec(e);if(t){var r=t[0];r.length!==e.length&&("	"===r[0]?n+=1:(i+=1,r.length>1&&r.length<s&&(s=r.length)))}}),!(i>n))return"	";for(var r="";s--;)r+=" ";return r}(e),r=a(e,{onValue:function(e){"Literal"===e.type&&"string"==typeof e.value&&(n[e.raw[0]]+=1)}}),o=n["'"]>n['"']?"'":'"',l=/\n/.test(e.slice(r.start,r.end))||"ArrayExpression"===r.type&&0===r.elements.length||"ObjectExpression"===r.type&&0===r.properties.length;return e.slice(0,r.start)+function e(t,n,s,r,o,a,l){var c=typeof n;if("string"===c)return"Literal"===t.type&&"string"==typeof t.value?y(n,t.raw[0]):y(n,a);if("number"===c){var h=t.raw,u=n,d=/^([-+])?0([boxBOX])/.exec(h);if(d&&u%1==0)return("+"===d[1]&&u>=0?"+":u<0?"-":"")+"0"+d[2]+Math.abs(u).toString("b"===d[2]||"B"===d[2]?2:"o"===d[2]||"O"===d[2]?8:"x"===d[2]||"X"===d[2]?16:null);var f=/^([-+])?(\.)?/.exec(h);return f&&f[0].length>0?("+"===f[1]&&u>=0?"+":u<0?"-":"")+(f[2]?String(Math.abs(u)).replace(/^0/,""):String(Math.abs(u))):String(u)}if("boolean"===c||null===n)return String(n);if(Array.isArray(n))return"ArrayExpression"===t.type?function(t,n,i,s,r,o,a){if(0===n.length)return 0===t.elements.length?i.slice(t.start,t.end):"[]";var l=b(i,t.start),c=""===l||/\n/.test(l);if(0===t.elements.length)return v(n,o,s,r,c);for(var h=0,u=t.start,d="",f=i.slice(t.start,t.end).split("\n").length>1;h<n.length;h+=1){var p=t.elements[h];p?(d+=i.slice(u,p.start)+e(p,n[h],i,s,r,o,f),u=p.end):f?d+=",\n"+(s+r)+v(n[h],o,s,r,!0):d+=", "+v(n[h],o,s,r,!1)}return h<t.elements.length&&(u=t.elements[t.elements.length-1].end),d+=i.slice(u,t.end)}(t,n,s,r,o,a,0):v(n,a,r,o,l);if("object"===c)return"ObjectExpression"===t.type?function(t,n,s,r,o,a,l){var c=Object.keys(n);if(0===c.length)return 0===t.properties.length?s.slice(t.start,t.end):"{}";var h={};t.properties.forEach(function(e){h[e.key.name]=e});var u=b(s,t.start),d=""===u||/\n/.test(u);if(0===t.properties.length)return v(n,a,r,o,d);for(var f=0,p=t.start,g="",y=/\n/.test(s.slice(t.start,t.end)),w=!1,x=s.slice(t.start,t.properties[0].start);f<t.properties.length;f+=1){var E=t.properties[f],S=n[E.key.name];r=function(e,t){for(;t>0&&!i.test(e[t-1]);)t-=1;for(var n=t;t>0&&i.test(e[t-1]);)t-=1;return e.slice(t,n)}(s,E.start),void 0!==S&&(g+=w?s.slice(p,E.value.start):x+s.slice(E.key.start,E.value.start),g+=e(E.value,S,s,r,o,a,y),w=!0),p=E.end}return c.forEach(function(e){if(!(e in h)){var t=n[e];g+=(w?","+(y?r:" "):x)+m(e,t,a,r,o,y),w=!0}}),g+=s.slice(p,t.end)}(t,n,s,r,o,a,0):v(n,a,r,o,l);throw Error("Cannot stringify "+c+"s")}(r,t,e,"",s,o,l)+e.slice(r.end)}function b(e,t){for(var n=t;t>0&&i.test(e[t]);)t-=1;return e.slice(t,n)}},46308:(e,t,n)=>{"use strict";var i;n.d(t,{s:()=>i}),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(i||(i={}))},46434:(e,t,n)=>{"use strict";function i(e){var t,n,i,r=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new s(t.call(e));n="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}function s(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(s=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new s(e)}n.d(t,{_:()=>i})},47477:(e,t,n)=>{"use strict";n.d(t,{eu:()=>o}),Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let i=Error("request for lock canceled");class s{constructor(e,t=i){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((n,i)=>{let s={resolve:n,reject:i,weight:e,priority:t},o=r(this._queue,e=>t<=e.priority);-1===o&&e<=this._value?this._dispatchItem(s):this._queue.splice(o+1,0,s)})}runExclusive(e){var t,n,i,s;return t=this,n=arguments,i=void 0,s=function*(e,t=1,n=0){let[i,s]=yield this.acquire(t,n);try{return yield e(i)}finally{s()}},new(i||(i=Promise))(function(e,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(t){var n;t.done?e(t.value):((n=t.value)instanceof i?n:new i(function(e){e(n)})).then(o,a)}l((s=s.apply(t,n||[])).next())})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(n=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),function(e,t){let n=r(e,e=>t.priority<=e.priority);e.splice(n+1,0,t)}(this._weightedWaiters[e-1],{resolve:n,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let n=this._weightedWaiters[t-1];if(!n)continue;let i=n.findIndex(t=>t.priority<=e);(-1===i?n:n.splice(0,i)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function r(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return -1}class o{constructor(e){this._semaphore=new s(1,e)}acquire(){var e,t,n,i;return e=this,t=arguments,n=void 0,i=function*(e=0){let[,t]=yield this._semaphore.acquire(1,e);return t},new(n||(n=Promise))(function(s,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,a)}l((i=i.apply(e,t||[])).next())})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}},54016:e=>{e.exports=function(e,t,n){var i=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(n=n>s?s:n)<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var r=Array(s);++i<s;)r[i]=e[i+t];return r}},55301:(e,t,n)=>{var i="__lodash_hash_undefined__",s=1/0,r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/,a=/^\./,l=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,c=/\\(\\)?/g,h=/^\[object .+?Constructor\]$/,u="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,d="object"==typeof self&&self&&self.Object===Object&&self,f=u||d||Function("return this")(),p=Array.prototype,g=Function.prototype,y=Object.prototype,m=f["__core-js_shared__"],v=function(){var e=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),w=g.toString,b=y.hasOwnProperty,x=y.toString,E=RegExp("^"+w.call(b).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=f.Symbol,k=p.splice,_=A(f,"Map"),C=A(Object,"create"),U=S?S.prototype:void 0,M=U?U.toString:void 0;function B(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function I(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function T(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function O(e,t){for(var n,i,s=e.length;s--;){if(n=e[s][0],n===(i=t)||n!=n&&i!=i)return s}return -1}function L(e,t){var n,i,s=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?s["string"==typeof t?"string":"hash"]:s.map}function A(e,t){var n,i,s,r=null==e?void 0:e[t];return!(!P(r)||(n=r,v&&v in n))&&("[object Function]"==(s=P(i=r)?x.call(i):"")||"[object GeneratorFunction]"==s||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(r)?E:h).test(function(e){if(null!=e){try{return w.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(r))?r:void 0}B.prototype.clear=function(){this.__data__=C?C(null):{}},B.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},B.prototype.get=function(e){var t=this.__data__;if(C){var n=t[e];return n===i?void 0:n}return b.call(t,e)?t[e]:void 0},B.prototype.has=function(e){var t=this.__data__;return C?void 0!==t[e]:b.call(t,e)},B.prototype.set=function(e,t){return this.__data__[e]=C&&void 0===t?i:t,this},I.prototype.clear=function(){this.__data__=[]},I.prototype.delete=function(e){var t=this.__data__,n=O(t,e);return!(n<0)&&(n==t.length-1?t.pop():k.call(t,n,1),!0)},I.prototype.get=function(e){var t=this.__data__,n=O(t,e);return n<0?void 0:t[n][1]},I.prototype.has=function(e){return O(this.__data__,e)>-1},I.prototype.set=function(e,t){var n=this.__data__,i=O(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},T.prototype.clear=function(){this.__data__={hash:new B,map:new(_||I),string:new B}},T.prototype.delete=function(e){return L(this,e).delete(e)},T.prototype.get=function(e){return L(this,e).get(e)},T.prototype.has=function(e){return L(this,e).has(e)},T.prototype.set=function(e,t){return L(this,e).set(e,t),this};var $=D(function(e){e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(H(e))return M?M.call(e):"";var t=e+"";return"0"==t&&1/e==-s?"-0":t}(t);var t,n=[];return a.test(e)&&n.push(""),e.replace(l,function(e,t,i,s){n.push(i?s.replace(c,"$1"):t||e)}),n});function D(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw TypeError("Expected a function");var n=function(){var i=arguments,s=t?t.apply(this,i):i[0],r=n.cache;if(r.has(s))return r.get(s);var o=e.apply(this,i);return n.cache=r.set(s,o),o};return n.cache=new(D.Cache||T),n}D.Cache=T;var R=Array.isArray;function P(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function H(e){return"symbol"==typeof e||!!e&&"object"==typeof e&&"[object Symbol]"==x.call(e)}e.exports=function(e,t,n){var i=null==e?void 0:function(e,t){var n;t=!function(e,t){if(R(e))return!1;var n=typeof e;return!!("number"==n||"symbol"==n||"boolean"==n||null==e||H(e))||o.test(e)||!r.test(e)||null!=t&&e in Object(t)}(t,e)?R(n=t)?n:$(n):[t];for(var i=0,a=t.length;null!=e&&i<a;)e=e[function(e){if("string"==typeof e||H(e))return e;var t=e+"";return"0"==t&&1/e==-s?"-0":t}(t[i++])];return i&&i==a?e:void 0}(e,t);return void 0===i?n:i}},56359:(e,t,n)=>{var i=n(43822),s=n(28309);e.exports=function(e,t){return i(e,t,function(t,n){return s(e,n)})}},57010:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var i=n(6639)._.getInstance()},57766:(e,t,n)=>{var i=n(15828),s=n(59671),r=n(98757);e.exports=function(e){return r(s(e,void 0,i),e+"")}},59254:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var i=Object.prototype.hasOwnProperty;function s(e,t,n){for(n of e.keys())if(r(n,t))return n}function r(e,t){var n,o,a;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&r(e[o],t[o]););return -1===o}if(n===Set){if(e.size!==t.size)return!1;for(o of e)if((a=o)&&"object"==typeof a&&!(a=s(t,a))||!t.has(a))return!1;return!0}if(n===Map){if(e.size!==t.size)return!1;for(o of e)if((a=o[0])&&"object"==typeof a&&!(a=s(t,a))||!r(o[1],t.get(a)))return!1;return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((o=e.byteLength)===t.byteLength)for(;o--&&e.getInt8(o)===t.getInt8(o););return -1===o}if(ArrayBuffer.isView(e)){if((o=e.byteLength)===t.byteLength)for(;o--&&e[o]===t[o];);return -1===o}if(!n||"object"==typeof e){for(n in o=0,e)if(i.call(e,n)&&++o&&!i.call(t,n)||!(n in t)||!r(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!=e&&t!=t}},59970:(e,t,n)=>{var i=n(29897),s={"{":"}","(":")","[":"]"},r=function(e){if("!"===e[0])return!0;for(var t=0,n=-2,i=-2,r=-2,o=-2,a=-2;t<e.length;){if("*"===e[t]||"?"===e[t+1]&&/[\].+)]/.test(e[t])||-1!==i&&"["===e[t]&&"]"!==e[t+1]&&(i<t&&(i=e.indexOf("]",t)),i>t)&&(-1===a||a>i||-1===(a=e.indexOf("\\",t))||a>i)||-1!==r&&"{"===e[t]&&"}"!==e[t+1]&&(r=e.indexOf("}",t))>t&&(-1===(a=e.indexOf("\\",t))||a>r)||-1!==o&&"("===e[t]&&"?"===e[t+1]&&/[:!=]/.test(e[t+2])&&")"!==e[t+3]&&(o=e.indexOf(")",t))>t&&(-1===(a=e.indexOf("\\",t))||a>o)||-1!==n&&"("===e[t]&&"|"!==e[t+1]&&(n<t&&(n=e.indexOf("|",t)),-1!==n&&")"!==e[n+1]&&(o=e.indexOf(")",n))>n)&&(-1===(a=e.indexOf("\\",n))||a>o))return!0;if("\\"===e[t]){var l=e[t+1];t+=2;var c=s[l];if(c){var h=e.indexOf(c,t);-1!==h&&(t=h+1)}if("!"===e[t])return!0}else t++}return!1},o=function(e){if("!"===e[0])return!0;for(var t=0;t<e.length;){if(/[*?{}()[\]]/.test(e[t]))return!0;if("\\"===e[t]){var n=e[t+1];t+=2;var i=s[n];if(i){var r=e.indexOf(i,t);-1!==r&&(t=r+1)}if("!"===e[t])return!0}else t++}return!1};e.exports=function(e,t){if("string"!=typeof e||""===e)return!1;if(i(e))return!0;var n=r;return t&&!1===t.strict&&(n=o),n(e)}},60563:(e,t,n)=>{var i=n(82274),s=n(54016);e.exports=function(e,t){return t.length<2?e:i(e,s(t,0,-1))}},63650:(e,t,n)=>{"use strict";var i;n.d(t,{s:()=>i}),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(i||(i={}))},67255:(e,t,n)=>{"use strict";let i;n.d(t,{A:()=>a});let s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},r=new Uint8Array(16),o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));let a=function(e,t,n){if(s.randomUUID&&!t&&!e)return s.randomUUID();let a=(e=e||{}).random??e.rng?.()??function(){if(!i){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=crypto.getRandomValues.bind(crypto)}return i(r)}();if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((n=n||0)<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=a[e];return t}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(a)}},68069:(e,t,n)=>{"use strict";n.d(t,{$:()=>m});var i=n(7079),s=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),r={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},o={set:function(e,t,n){null!=e&&(e[t]=n)}},a=n(6639),l=(0,n(3107).n)("OpenTelemetry Baggage Key");function c(e){return e.getValue(l)||void 0}function h(){return c(a._.getInstance().active())}function u(e,t){return e.setValue(l,t)}function d(e){return e.deleteValue(l)}var f=n(30977),p=n(81720),g="propagation",y=new s,m=(function(){function e(){this.createBaggage=f.L,this.getBaggage=c,this.getActiveBaggage=h,this.setBaggage=u,this.deleteBaggage=d}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return(0,i.$G)(g,e,p.K.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=o),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=r),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){(0,i.kv)(g,p.K.instance())},e.prototype._getGlobalPropagator=function(){return(0,i.mS)(g)||y},e})().getInstance()},68248:(e,t,n)=>{"use strict";let i;n.d(t,{$C:()=>_,Bi:()=>O,EK:()=>z,O9:()=>D,UU:()=>V,YD:()=>H,_I:()=>q,bH:()=>R,f2:()=>X,iH:()=>N,mH:()=>M,o0:()=>F,oG:()=>j,rE:()=>Y,sE:()=>P,ug:()=>I,uq:()=>L,vL:()=>B,xH:()=>J,yU:()=>T});var s=n(74651),r=n(17616),o=n(68069),a=n(57010),l=n(91630),c=n(3181),h=n(97858),u=n(16128),d="UNEXPECTED_DISCONNECT",f="CANCEL",p=e=>s.ZU.Object({ok:s.ZU.Literal(!1),payload:e}),g=s.ZU.Object({path:s.ZU.String(),message:s.ZU.String()});s.ZU.Array(g);var y=s.ZU.Object({code:s.ZU.Literal(f),message:s.ZU.String()});p(y);var m=s.ZU.Union([s.ZU.Object({code:s.ZU.Literal("UNCAUGHT_ERROR"),message:s.ZU.String()}),s.ZU.Object({code:s.ZU.Literal(d),message:s.ZU.String()}),s.ZU.Object({code:s.ZU.Literal("INVALID_REQUEST"),message:s.ZU.String(),extras:s.ZU.Optional(s.ZU.Object({firstValidationErrors:s.ZU.Array(g),totalErrors:s.ZU.Number()}))}),y]),v=p(m),w=s.ZU.Union([s.ZU.Object({ok:s.ZU.Literal(!1),payload:s.ZU.Object({code:s.ZU.String(),message:s.ZU.String(),extras:s.ZU.Optional(s.ZU.Unknown())})}),s.ZU.Object({ok:s.ZU.Literal(!0),payload:s.ZU.Unknown()})]);function b(e){return{ok:!1,payload:e}}var x={code:"READABLE_BROKEN",message:"Readable was broken before it is fully consumed"},E=class{closed=!1;locked=!1;broken=!1;brokenWithValuesLeftToRead=!1;queue=[];next=null;[Symbol.asyncIterator](){if(this.locked)throw TypeError("Readable is already locked");this.locked=!0;let e=!1;return{next:async()=>{if(e)return{done:!0,value:void 0};for(;0===this.queue.length;){if(this.closed&&!this.brokenWithValuesLeftToRead)return{done:!0,value:void 0};if(this.broken)return e=!0,{done:!1,value:b(x)};this.next||(this.next=function(){let e,t;return{promise:new Promise((n,i)=>{e=n,t=i}),resolve:e,reject:t}}()),await this.next.promise,this.next=null}return{done:!1,value:this.queue.shift()}},return:async()=>(this.break(),{done:!0,value:void 0})}}async collect(){let e=[];for await(let t of this)e.push(t);return e}break(){this.broken||(this.locked=!0,this.broken=!0,this.brokenWithValuesLeftToRead=this.queue.length>0,this.queue.length=0,this.next?.resolve())}isReadable(){return!this.locked&&!this.broken}_pushValue(e){if(!this.broken){if(this.closed)throw Error("Cannot push to closed Readable");this.queue.push(e),this.next?.resolve()}}_triggerClose(){if(this.closed)throw Error("Unexpected closing multiple times");this.closed=!0,this.next?.resolve()}_hasValuesInQueue(){return this.queue.length>0}isClosed(){return this.closed}},S=class{writeCb;closeCb;closed=!1;constructor(e){this.writeCb=e.writeCb,this.closeCb=e.closeCb}write(e){if(this.closed)throw Error("Cannot write to closed Writable");this.writeCb(e)}isWritable(){return!this.closed}close(){this.closed||(this.closed=!0,this.writeCb=()=>void 0,this.closeCb(),this.closeCb=()=>void 0)}isClosed(){return this.closed}},k=(0,r.d_)("1234567890abcdefghijklmnopqrstuvxyzABCDEFGHIJKLMNOPQRSTUVXYZ"),_=()=>k(12),C=s.ZU.Object({type:s.ZU.Literal("ACK")}),U=s.ZU.Object({type:s.ZU.Literal("CLOSE")}),M="v2.0",B=["v1.1",M];function I(e){return B.includes(e)}var T=s.ZU.Object({type:s.ZU.Literal("HANDSHAKE_REQ"),protocolVersion:s.ZU.String(),sessionId:s.ZU.String(),expectedSessionState:s.ZU.Object({nextExpectedSeq:s.ZU.Integer(),nextSentSeq:s.ZU.Integer()}),metadata:s.ZU.Optional(s.ZU.Unknown())}),O=s.ZU.Union([s.ZU.Literal("SESSION_STATE_MISMATCH")]),L=s.ZU.Union([s.ZU.Literal("REJECTED_UNSUPPORTED_CLIENT"),s.ZU.Literal("REJECTED_BY_CUSTOM_HANDLER")]),A=s.ZU.Union([L,s.ZU.Literal("MALFORMED_HANDSHAKE_META"),s.ZU.Literal("MALFORMED_HANDSHAKE"),s.ZU.Literal("PROTOCOL_VERSION_MISMATCH")]),$=s.ZU.Union([O,A]),D=s.ZU.Object({type:s.ZU.Literal("HANDSHAKE_RESP"),status:s.ZU.Union([s.ZU.Object({ok:s.ZU.Literal(!0),sessionId:s.ZU.String()}),s.ZU.Object({ok:s.ZU.Literal(!1),reason:s.ZU.String(),code:$})])});s.ZU.Union([U,C,T,D]);var R=(i=s.ZU.Unknown(),s.ZU.Object({id:s.ZU.String(),from:s.ZU.String(),to:s.ZU.String(),seq:s.ZU.Integer(),ack:s.ZU.Integer(),serviceName:s.ZU.Optional(s.ZU.String()),procedureName:s.ZU.Optional(s.ZU.String()),streamId:s.ZU.String(),controlFlags:s.ZU.Integer(),tracing:s.ZU.Optional(s.ZU.Object({traceparent:s.ZU.String(),tracestate:s.ZU.String()})),payload:i}));function P({from:e,to:t,sessionId:n,expectedSessionState:i,metadata:s,tracing:r}){return{id:_(),from:e,to:t,seq:0,ack:0,streamId:_(),controlFlags:0,tracing:r,payload:{type:"HANDSHAKE_REQ",protocolVersion:M,sessionId:n,expectedSessionState:i,metadata:s}}}function H({from:e,to:t,status:n}){return{id:_(),from:e,to:t,seq:0,ack:0,streamId:_(),controlFlags:0,payload:{type:"HANDSHAKE_RESP",status:n}}}function F(e){return(1&e)==1}function j(e){let t={traceparent:"",tracestate:""};return o.$.inject(e,t),t}function N(e,t,n,i,s){let r=s?o.$.extract(a._.active(),s):a._.active(),c=e.startSpan("river.session",{attributes:{component:"river","river.session.id":t,"river.session.to":n,"river.session.from":i}},r),h=l.u.setSpan(r,c);return{span:c,ctx:h}}function q(e,t,n){let i=e.startSpan("river.connection",{attributes:{component:"river","river.connection.id":t.id},links:[{context:n.span.spanContext()}]},n.ctx),s=l.u.setSpan(n.ctx,i);return{span:i,ctx:s}}function z(){return l.u.getTracer("river",Y)}var W=()=>{},Z={connectOnInvoke:!0,eagerlyConnect:!0};function V(e,t,n={}){n.handshakeOptions&&e.extendHandshake(n.handshakeOptions);let i={...Z,...n};return i.eagerlyConnect&&e.connect(t),function e(t,n){return new Proxy(W,{get(i,s){if("string"==typeof s)return e(t,[...n,s])},apply:(e,i,s)=>t({path:n,args:s})})}(n=>{let[s,r,o]=[...n.path];if(!(s&&r&&o))throw Error("invalid river call, ensure the service and procedure you are calling exists");let[p,g]=n.args;if(i.connectOnInvoke&&!e.sessions.has(t)&&e.connect(t),"rpc"!==o&&"subscribe"!==o&&"stream"!==o&&"upload"!==o)throw Error(`invalid river call, unknown procedure type ${o}`);return function(e,t,n,i,s,r,o){if("closed"===t.getStatus()){var p=e;let t=new E,n=b({code:d,message:"transport is closed"});t._pushValue(n),t._triggerClose();let i=new S({writeCb:()=>{},closeCb:()=>{}});return i.close(),G(p,t,i)}let g=t.sessions.get(n)??t.createUnconnectedSession(n),y=t.getSessionBoundSendFn(n,g.id),m="rpc"===e||"subscription"===e,x=_(),{span:k,ctx:C}=function(e,t,n,i,s,r){let o=a._.active(),h=e.startSpan(`river.client.${i}.${s}`,{attributes:{component:"river","river.method.kind":n,"river.method.service":i,"river.method.name":s,"river.streamId":r,"span.kind":"client"},links:[{context:t.telemetry.span.spanContext()}],kind:c.v.CLIENT},o),u=l.u.setSpan(o,h),d={...t.loggingMetadata,transportMessage:{procedureName:s,serviceName:i}};return h.isRecording()&&(d.telemetry={traceId:h.spanContext().traceId,spanId:h.spanContext().spanId}),t.log?.info(`invoked ${i}.${s}`,d),{span:h,ctx:u}}(t.tracer,g,e,s,r,x),M=!0,B=new S({writeCb:e=>{y({streamId:x,payload:e,controlFlags:0})},closeCb:()=>{k.addEvent("reqWritable closed"),!m&&M&&y({streamId:x,controlFlags:8,payload:{type:"CLOSE"}}),I.isClosed()&&O()}}),I=new E,T=()=>{I._triggerClose(),k.addEvent("resReadable closed"),B.isClosed()&&O()};function O(){t.removeEventListener("message",A),t.removeEventListener("sessionStatus",$),o?.removeEventListener("abort",L),k.end()}function L(){!(I.isClosed()&&B.isClosed())&&(k.addEvent("sending cancel"),M=!1,I.isClosed()||(I._pushValue(b({code:f,message:"cancelled by client"})),T()),B.close(),y({streamId:x,controlFlags:4,payload:b({code:f,message:"cancelled by client"})}))}function A(e){if(e.streamId===x){if(e.to!==t.clientId)return void t.log?.error("got stream message from unexpected client",{clientId:t.clientId,transportMessage:e});if((4&e.controlFlags)==4){let n;M=!1,k.addEvent("received cancel"),h.J(v,e.payload)?n=e.payload:(n=b({code:f,message:"stream cancelled with invalid payload"}),t.log?.warn("got stream cancel without a valid protocol error",{clientId:t.clientId,transportMessage:e,validationErrors:[...u.I(v,e.payload)]})),I.isClosed()||(I._pushValue(n),T()),B.close();return}if(I.isClosed()){k.recordException("received message after response stream is closed"),t.log?.error("received message after response stream is closed",{clientId:t.clientId,transportMessage:e});return}h.J(U,e.payload)||(h.J(w,e.payload)?I._pushValue(e.payload):t.log?.error("Got non-control payload, but was not a valid result",{clientId:t.clientId,transportMessage:e,validationErrors:[...u.I(w,e.payload)]})),(8&e.controlFlags)==8&&(k.addEvent("received response close"),I.isClosed()?t.log?.error("received stream close but readable was already closed"):T())}}function $(e){"closing"===e.status&&e.session.to===n&&g.id===e.session.id&&(M=!1,I.isClosed()||(I._pushValue(b({code:d,message:`${n} unexpectedly disconnected`})),T()),B.close())}return o?.addEventListener("abort",L),t.addEventListener("message",A),t.addEventListener("sessionStatus",$),y({streamId:x,serviceName:s,procedureName:r,tracing:j(C),payload:i,controlFlags:m?10:2}),m&&B.close(),G(e,I,B,t.log)}("subscribe"===o?"subscription":o,e,t,p,s,r,g?g.signal:void 0)},[])}function G(e,t,n,i){if("subscription"===e)return{resReadable:t};if("rpc"===e)return K(t,i);if("upload"===e){let e=!1;return{reqWritable:n,finalize:()=>{if(e)throw Error("upload stream already finalized");return e=!0,n.isClosed()||n.close(),K(t,i)}}}return{resReadable:t,reqWritable:n}}async function K(e,t){let n=await e.collect();return n.length>1&&t?.error("Expected single message from server, got multiple"),n[0]}function J(e){return e instanceof Error?e.message||"unknown reason":`[coerced to error] ${String(e)}`}function X(e,t){return{schema:e,construct:t}}var Y="0.209.6"},69696:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,i.default)(e),(t=(0,s.default)(t,o)).allow_trailing_dot&&"."===e[e.length-1]&&(e=e.substring(0,e.length-1)),!0===t.allow_wildcard&&0===e.indexOf("*.")&&(e=e.substring(2));var n=e.split("."),r=n[n.length-1];return!(t.require_tld&&(n.length<2||!t.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(r)||/\s/.test(r)))&&!(!t.allow_numeric_tld&&/^\d+$/.test(r))&&n.every(function(e){return!(e.length>63&&!t.ignore_max_length||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(e)||/[\uff01-\uff5e]/.test(e)||/^-|-$/.test(e)||!t.allow_underscores&&/_/.test(e))})};var i=r(n(6235)),s=r(n(29588));function r(e){return e&&e.__esModule?e:{default:e}}var o={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};e.exports=t.default,e.exports.default=t.default},85001:(e,t,n)=>{"use strict";n.d(t,{I:()=>d});var i=n(37591),s=n(38325),r=n(48055),o=n(63650),a=n(97858),l=n(16128),c=class{budgetConsumed;intervalHandle;options;constructor(e){this.options=e,this.budgetConsumed=0}getBackoffMs(){if(0===this.getBudgetConsumed())return 0;let e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*2**e,this.options.maxBackoffMs)+t}get totalBudgetRestoreTime(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}consumeBudget(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}getBudgetConsumed(){return this.budgetConsumed}hasBudget(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}startRestoringBudget(){if(this.intervalHandle)return;let e=()=>{let e=this.budgetConsumed;if(!e)return void this.stopLeak();let t=e-1;0!==t&&(this.budgetConsumed=t)};this.intervalHandle=setInterval(e,this.options.budgetRestoreIntervalMs)}stopLeak(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}close(){this.stopLeak()}},h=class extends i.oK{options;retryBudget;reconnectOnConnectionDrop=!0;handshakeExtensions;sessions;constructor(e,t){super(e,t),this.sessions=new Map,this.options={...s.I$,...t},this.retryBudget=new c(this.options)}extendHandshake(e){this.handshakeExtensions=e}tryReconnecting(e){let t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}send(e,t){if("closed"===this.getStatus()){let e="transport is closed, cant send";throw this.log?.error(e,{clientId:this.clientId,transportMessage:t,tags:["invariant-violation"]}),Error(e)}let n=this.sessions.get(e);return n||(n=this.createUnconnectedSession(e)),n.send(t)}createUnconnectedSession(e){let t=s.Dl.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}},this.options,this.log);return this.updateSession(t),t}onConnectingFailed(e){let t=super.onConnectingFailed(e);return this.tryReconnecting(t.to),t}onConnClosed(e){let t=super.onConnClosed(e);return this.tryReconnecting(t.to),t}onConnectionEstablished(e,t){let n=s.Dl.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:e=>{let t=(0,r.xH)(e);this.log?.error(`connection to ${n.to} errored during handshake: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.warn(`connection to ${n.to} closed during handshake`,n.loggingMetadata),this.onConnClosed(n)},onHandshake:e=>{this.onHandshakeResponse(n,e)},onInvalidHandshake:(t,s)=>{this.log?.error(`invalid handshake: ${t}`,n.loggingMetadata),this.deleteSession(e,{unhealthy:!0}),this.protocolError({type:i.bd.HandshakeFailed,code:s,message:t})},onHandshakeTimeout:()=>{this.log?.error(`connection to ${n.to} timed out during handshake`,n.loggingMetadata),this.onConnClosed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});return this.updateSession(n),this.sendHandshake(n),n}rejectHandshakeResponse(e,t,n){e.conn.telemetry?.span.setStatus({code:o.s.ERROR,message:t}),this.log?.warn(t,n),this.deleteSession(e,{unhealthy:!0})}onHandshakeResponse(e,t){if(!a.J(r.O9,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",{...e.loggingMetadata,transportMessage:t,validationErrors:[...l.I(r.O9,t.payload)]});if(!t.payload.status.ok){let n=a.J(r.Bi,t.payload.status.code),s=`handshake failed: ${t.payload.status.reason}`,o=e.to;this.rejectHandshakeResponse(e,s,{...e.loggingMetadata,transportMessage:t}),n?this.tryReconnecting(o):this.protocolError({type:i.bd.HandshakeFailed,code:t.payload.status.code,message:s});return}if(t.payload.status.sessionId!==e.id){let n=`session id mismatch: expected ${e.id}, got ${t.payload.status.sessionId}`;this.rejectHandshakeResponse(e,n,{...e.loggingMetadata,transportMessage:t});return}this.log?.info(`handshake from ${t.from} ok`,{...e.loggingMetadata,transportMessage:t});let n=s.Dl.transition.HandshakingToConnected(e,{onConnectionErrored:e=>{let t=(0,r.xH)(e);this.log?.warn(`connection to ${n.to} errored: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.info(`connection to ${n.to} closed`,n.loggingMetadata),this.onConnClosed(n)},onMessage:e=>this.handleMsg(e),onInvalidMessage:e=>{this.deleteSession(n,{unhealthy:!0}),this.protocolError({type:i.bd.InvalidMessage,message:e})}});this.updateSession(n),this.retryBudget.startRestoringBudget()}connect(e){if("open"!==this.getStatus())return void this.log?.info(`transport state is no longer open, cancelling attempt to connect to ${e}`);let t=this.sessions.get(e);if("NoConnection"!==(t??=this.createUnconnectedSession(e)).state)return void this.log?.debug(`session to ${e} has state ${t.state}, skipping connect attempt`,t.loggingMetadata);if(!this.retryBudget.hasBudget()){let n=this.retryBudget.getBudgetConsumed(),s=`tried to connect to ${e} but retry budget exceeded (more than ${n} attempts in the last ${this.retryBudget.totalBudgetRestoreTime}ms)`;this.log?.error(s,t.loggingMetadata),this.protocolError({type:i.bd.RetriesExceeded,message:s});return}let n=this.retryBudget.getBackoffMs();this.log?.info(`attempting connection to ${e} (${n}ms backoff)`,t.loggingMetadata),this.retryBudget.consumeBudget();let r=s.Dl.transition.NoConnectionToBackingOff(t,n,{onBackoffFinished:()=>{this.onBackoffFinished(r)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(r)}});this.updateSession(r)}onBackoffFinished(e){let t=r.VL.startActiveSpan("connect",async t=>{try{return await this.createNewOutgoingConnection(e.to)}catch(n){let e=(0,r.xH)(n);throw t.recordException(e),t.setStatus({code:o.s.ERROR}),n}finally{t.end()}}),n=s.Dl.transition.BackingOffToConnecting(e,t,{onConnectionEstablished:e=>{this.log?.debug(`connection to ${n.to} established`,{...e.loggingMetadata,...n.loggingMetadata}),this.onConnectionEstablished(n,e)},onConnectionFailed:e=>{let t=(0,r.xH)(e);this.log?.error(`error connecting to ${n.to}: ${t}`,n.loggingMetadata),this.onConnectingFailed(n)},onConnectionTimeout:()=>{this.log?.error(`connection to ${n.to} timed out`,n.loggingMetadata),this.onConnectingFailed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});this.updateSession(n)}async sendHandshake(e){let t;if(this.handshakeExtensions&&(t=await this.handshakeExtensions.construct()),e._isConsumed)return;let n=(0,r.sE)({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:t,tracing:(0,r.oG)(e.telemetry.ctx)});this.log?.debug(`sending handshake request to ${e.to}`,{...e.loggingMetadata,transportMessage:n}),e.sendHandshake(n)}close(){this.retryBudget.close(),super.close()}},u=class extends i.Ng{ws;extras;get loggingMetadata(){let e=super.loggingMetadata;return this.extras&&(e.extras=this.extras),e}constructor(e,t){super(),this.ws=e,this.extras=t,this.ws.binaryType="arraybuffer";let n=!1;this.ws.onerror=()=>{n=!0},this.ws.onclose=({code:e,reason:t})=>{if(n){let n=Error(`websocket closed with code and reason: ${e} - ${t}`);for(let e of this.errorListeners)e(n)}for(let e of this.closeListeners)e()},this.ws.onmessage=e=>{for(let t of this.dataListeners)t(e.data)}}send(e){return this.ws.readyState===this.ws.OPEN&&(this.ws.send(e),!0)}close(){this.ws.close(1e3)}},d=class extends h{wsGetter;constructor(e,t,n){super(t,n),this.wsGetter=e}async createNewOutgoingConnection(e){this.log?.info(`establishing a new websocket to ${e}`,{clientId:this.clientId,connectedTo:e});let t=await this.wsGetter(e);await new Promise((e,n)=>t.readyState===t.OPEN?void e():t.readyState===t.CLOSING||t.readyState===t.CLOSED?void n(Error("ws is closing or closed")):void(t.onopen=()=>{e()},t.onclose=e=>{n(Error(e.reason))},t.onerror=e=>{n(Error(e.message))}));let n=new u(t);return this.log?.info(`raw websocket to ${e} ok`,{clientId:this.clientId,connectedTo:e,...n.loggingMetadata}),n}}},90067:(e,t,n)=>{"use strict";n.d(t,{a6:()=>m,vt:()=>V});var i=n(95570);let s={Remove:"remove",Replace:"replace",Add:"add"},r=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),o=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),a=Symbol.iterator,l={mutable:"mutable",immutable:"immutable"},c={};function h(e,t){return e instanceof Map?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){if(t in e){let n=Reflect.getPrototypeOf(e);for(;n;){let e=Reflect.getOwnPropertyDescriptor(n,t);if(e)return e;n=Reflect.getPrototypeOf(n)}}}function d(e){return Object.getPrototypeOf(e)===Set.prototype}function f(e){return Object.getPrototypeOf(e)===Map.prototype}function p(e){var t;return null!=(t=e.copy)?t:e.original}function g(e){return"object"!=typeof e?null:null==e?void 0:e[r]}function y(e){var t;let n=g(e);return n?null!=(t=n.copy)?t:n.original:e}function m(e,t){let n;return!!e&&"object"==typeof e&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||e instanceof Map||e instanceof Set||!!(null==t?void 0:t.mark)&&((n=t.mark(e,l))===l.immutable||"function"==typeof n))}function v(e){return Array.isArray(e)?1:e instanceof Map?2:3*(e instanceof Set)}function w(e,t){return 2===v(e)?e.get(t):e[t]}function b(e,t,n){2===v(e)?e.set(t,n):e[t]=n}function x(e,t){let n=g(e);return(n?p(n):e)[t]}function E(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function S(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function k(e,t){return t?e:[""].concat(e).map(e=>{let t=`${e}`;return -1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}let _=Object.prototype.propertyIsEnumerable;function C(e,t){let n;if(Array.isArray(e))return Array.prototype.concat.call(e);if(e instanceof Set)return d(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if(e instanceof Map)return f(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if((null==t?void 0:t.mark)&&void 0!==(n=t.mark(e,l))&&n!==l.mutable){if(n===l.immutable){let t=Object.create(Object.getPrototypeOf(e));return Reflect.ownKeys(e).forEach(n=>{let i=Reflect.getOwnPropertyDescriptor(e,n);if(i.enumerable&&i.configurable&&i.writable){t[n]=e[n];return}i.writable||(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(i={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[n]}),Reflect.defineProperty(t,n,i)}),t}if("function"==typeof n){if(t.enablePatches||t.enableAutoFreeze)throw Error("You can't use mark and patches or auto freeze together.");return n()}throw Error(`Unsupported mark result: ${n}`)}if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype){let t={};return Object.keys(e).forEach(n=>{t[n]=e[n]}),Object.getOwnPropertySymbols(e).forEach(n=>{_.call(e,n)&&(t[n]=e[n])}),t}else throw Error("Please check mark() to ensure that it is a stable marker draftable function.")}function U(e){e.copy||(e.copy=C(e.original,e.options))}function M(e){return g(e)?function e(t){if(!m(t))return y(t);if(Array.isArray(t))return t.map(e);if(t instanceof Map){let n=Array.from(t.entries()).map(([t,n])=>[t,e(n)]);return f(t)?new Map(n):new(Object.getPrototypeOf(t)).constructor(n)}if(t instanceof Set){let n=Array.from(t).map(e);return d(t)?new Set(n):new(Object.getPrototypeOf(t)).constructor(n)}let n=Object.create(Object.getPrototypeOf(t));for(let i in t)n[i]=e(t[i]);return n}(e):e}function B(e){var t;e.assignedMap=null!=(t=e.assignedMap)?t:new Map,!e.operated&&(e.operated=!0,e.parent&&B(e.parent))}function I(){throw Error("Cannot modify frozen object")}function T(e,t){let n=v(e);if(0===n)Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)});else if(1===n){let n=0;for(let i of e)t(n,i,e),n+=1}else e.forEach((n,i)=>t(i,n,e))}function O(e){3===e.type&&e.copy&&(e.copy.clear(),e.setMap.forEach(t=>{e.copy.add(y(t))}))}function L(e,t,n,i){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&i){let s=function e(t,n=[]){if(Object.hasOwnProperty.call(t,"key")){let e=t.parent.copy,i=g(w(e,t.key));if(null!==i&&(null==i?void 0:i.original)!==t.original)return null;let s=3===t.parent.type,r=s?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(s&&e.size>r||h(e,r)))return null;n.push(r)}if(t.parent)return e(t.parent,n);n.reverse();try{var i=t.copy,s=n;for(let e=0;e<s.length-1;e+=1){let t=s[e];if("object"!=typeof(i=w(3===v(i)?Array.from(i):i,t)))throw Error(`Cannot resolve patch at '${s.join("/")}'.`)}}catch(e){return null}return n}(e);s&&t(e,s,n,i)}e.finalized=!0}}function A(e,t,n,i){let s=g(n);s&&(s.callbacks||(s.callbacks=[]),s.callbacks.push((r,o)=>{var a;let l=3===e.type?e.setMap:e.copy;if(E(w(l,t),n)){let n=s.original;s.copy&&(n=s.copy),O(e),L(e,i,r,o),e.options.enableAutoFreeze&&(e.options.updatedValues=null!=(a=e.options.updatedValues)?a:new WeakMap,e.options.updatedValues.set(n,s.original)),b(l,t,n)}}),e.options.enableAutoFreeze&&s.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),m(n,e.options)&&e.finalities.draft.push(()=>{E(w(3===e.type?e.setMap:e.copy,t),n)&&function(e,t){let n=3===e.type?e.setMap:e.copy;e.finalities.revoke.length>1&&e.assignedMap.get(t)&&n&&function e(t,n,i){if(g(t)||!m(t,i)||n.has(t)||Object.isFrozen(t))return;let s=t instanceof Set,r=s?new Map:void 0;if(n.add(t),T(t,(o,a)=>{var l;if(g(a)){let e=g(a);U(e),b(s?r:t,o,(null==(l=e.assignedMap)?void 0:l.size)||e.operated?e.copy:e.original)}else e(a,n,i)}),r){let e=Array.from(t);t.clear(),e.forEach(e=>{t.add(r.has(e)?r.get(e):e)})}}(w(n,t),e.finalities.handledSet,e.options)}(e,t)})}function $(e,t,n,i){let{pathAsArray:r=!0}=e.options.enablePatches;switch(e.type){case 0:case 2:return function({original:e,copy:t,assignedMap:n},i,r,o,a){n.forEach((n,l)=>{let c=w(e,l),u=M(w(t,l)),d=n?h(e,l)?s.Replace:s.Add:s.Remove;if(E(c,u)&&d===s.Replace)return;let f=k(i.concat(l),a);r.push(d===s.Remove?{op:d,path:f}:{op:d,path:f,value:u}),o.push(d===s.Add?{op:s.Remove,path:f}:d===s.Remove?{op:s.Add,path:f,value:c}:{op:s.Replace,path:f,value:c})})}(e,t,n,i,r);case 1:return function(e,t,n,i,r){let{original:o,assignedMap:a,options:l}=e,c=e.copy;c.length<o.length&&([o,c]=[c,o],[n,i]=[i,n]);for(let e=0;e<o.length;e+=1)if(a.get(e.toString())&&c[e]!==o[e]){let a=k(t.concat([e]),r);n.push({op:s.Replace,path:a,value:M(c[e])}),i.push({op:s.Replace,path:a,value:M(o[e])})}for(let e=o.length;e<c.length;e+=1){let i=k(t.concat([e]),r);n.push({op:s.Add,path:i,value:M(c[e])})}if(o.length<c.length){let{arrayLengthAssignment:e=!0}=l.enablePatches;if(e){let e=k(t.concat(["length"]),r);i.push({op:s.Replace,path:e,value:o.length})}else for(let e=c.length;o.length<e;e-=1){let n=k(t.concat([e-1]),r);i.push({op:s.Remove,path:n})}}}(e,t,n,i,r);case 3:return function({original:e,copy:t},n,i,r,o){let a=0;e.forEach(e=>{if(!t.has(e)){let t=k(n.concat([a]),o);i.push({op:s.Remove,path:t,value:e}),r.unshift({op:s.Add,path:t,value:e})}a+=1}),a=0,t.forEach(t=>{if(!e.has(t)){let e=k(n.concat([a]),o);i.push({op:s.Add,path:e,value:t}),r.unshift({op:s.Remove,path:e,value:t})}a+=1})}(e,t,n,i,r)}}let D=(e,t,n=!1)=>{if("object"==typeof e&&null!==e&&(!m(e,t)||n)&&1)throw Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},R={get size(){return p(g(this)).size},has(e){return p(g(this)).has(e)},set(e,t){let n=g(this),i=p(n);return i.has(e)&&E(i.get(e),t)||(U(n),B(n),n.assignedMap.set(e,!0),n.copy.set(e,t),A(n,e,t,$)),this},delete(e){if(!this.has(e))return!1;let t=g(this);return U(t),B(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear(){let e=g(this);if(this.size){for(let[t]of(U(e),B(e),e.assignedMap=new Map,e.original))e.assignedMap.set(t,!1);e.copy.clear()}},forEach(e,t){p(g(this)).forEach((n,i)=>{e.call(t,this.get(i),i,this)})},get(e){var t,n;let i=g(this),s=p(i).get(e),r=(null==(n=(t=i.options).mark)?void 0:n.call(t,s,l))===l.mutable;if(i.options.strict&&D(s,i.options,r),r||i.finalized||!m(s,i.options)||s!==i.original.get(e))return s;let o=c.createDraft({original:s,parentDraft:i,key:e,finalities:i.finalities,options:i.options});return U(i),i.copy.set(e,o),o},keys(){return p(g(this)).keys()},values(){let e=this.keys();return{[a]:()=>this.values(),next:()=>{let t=e.next();return t.done?t:{done:!1,value:this.get(t.value)}}}},entries(){let e=this.keys();return{[a]:()=>this.entries(),next:()=>{let t=e.next();if(t.done)return t;let n=this.get(t.value);return{done:!1,value:[t.value,n]}}}},[a](){return this.entries()}},P=Reflect.ownKeys(R),H=(e,t,{isValuesIterator:n})=>()=>{var i,s;let r=t.next();if(r.done)return r;let o=r.value,a=e.setMap.get(o),h=g(a),u=(null==(s=(i=e.options).mark)?void 0:s.call(i,a,l))===l.mutable;if(e.options.strict&&D(o,e.options,u),!u&&!h&&m(o,e.options)&&!e.finalized&&e.original.has(o)){let t=c.createDraft({original:o,parentDraft:e,key:o,finalities:e.finalities,options:e.options});e.setMap.set(o,t),a=t}else h&&(a=h.proxy);return{done:!1,value:n?a:[a,a]}},F={get size(){return g(this).setMap.size},has(e){let t=g(this);if(t.setMap.has(e))return!0;U(t);let n=g(e);return!!(n&&t.setMap.has(n.original))},add(e){let t=g(this);return this.has(e)||(U(t),B(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),A(t,e,e,$)),this},delete(e){if(!this.has(e))return!1;let t=g(this);U(t),B(t);let n=g(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear(){if(!this.size)return;let e=g(this);for(let t of(U(e),B(e),e.original))e.assignedMap.set(t,!1);e.setMap.clear()},values(){let e=g(this);U(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:H(e,t,{isValuesIterator:!0})}},entries(){let e=g(this);U(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:H(e,t,{isValuesIterator:!1})}},keys(){return this.values()},[a](){return this.values()},forEach(e,t){let n=this.values(),i=n.next();for(;!i.done;)e.call(t,i.value,i.value,this),i=n.next()}};Set.prototype.difference&&Object.assign(F,{intersection(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union(e){return Set.prototype.union.call(new Set(this.values()),e)},difference(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});let j=Reflect.ownKeys(F),N=new WeakSet,q={get(e,t,n){var i,s;let o,a=null==(i=e.copy)?void 0:i[t];if(a&&N.has(a))return a;if(t===r)return e;if(e.options.mark){let i="size"===t&&(e.original instanceof Map||e.original instanceof Set)?Reflect.get(e.original,t):Reflect.get(e.original,t,n);if((o=e.options.mark(i,l))===l.mutable)return e.options.strict&&D(i,e.options,!0),i}let c=p(e);if(c instanceof Map&&P.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(R,"size").get.call(e.proxy);let n=R[t];if(n)return n.bind(e.proxy)}if(c instanceof Set&&j.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(F,"size").get.call(e.proxy);let n=F[t];if(n)return n.bind(e.proxy)}if(!h(c,t)){let n=u(c,t);return n?"value"in n?n.value:null==(s=n.get)?void 0:s.call(e.proxy):void 0}let d=c[t];if(e.options.strict&&D(d,e.options),e.finalized||!m(d,e.options))return d;if(d===x(e.original,t)){if(U(e),e.copy[t]=z({original:e.original[t],parentDraft:e,key:1===e.type?Number(t):t,finalities:e.finalities,options:e.options}),"function"==typeof o){let n=g(e.copy[t]);return U(n),B(n),n.copy}return e.copy[t]}return d},set(e,t,n){var i;let s;if(3===e.type||2===e.type)throw Error("Map/Set draft does not support any property assignment.");if(1===e.type&&"length"!==t&&!(Number.isInteger(s=Number(t))&&s>=0&&(0===t||0===s||String(s)===String(t))))throw Error("Only supports setting array indices and the 'length' property.");let r=u(p(e),t);if(null==r?void 0:r.set)return r.set.call(e.proxy,n),!0;let o=x(p(e),t),a=g(o);return a&&E(a.original,n)?(e.copy[t]=n,e.assignedMap=null!=(i=e.assignedMap)?i:new Map,e.assignedMap.set(t,!1),!0):!!(E(n,o)&&(void 0!==n||h(e.original,t)))||(U(e),B(e),h(e.original,t)&&E(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,A(e,t,n,$),!0)},has:(e,t)=>t in p(e),ownKeys:e=>Reflect.ownKeys(p(e)),getOwnPropertyDescriptor(e,t){let n=p(e),i=Reflect.getOwnPropertyDescriptor(n,t);return i?{writable:!0,configurable:1!==e.type||"length"!==t,enumerable:i.enumerable,value:n[t]}:i},getPrototypeOf:e=>Reflect.getPrototypeOf(e.original),setPrototypeOf(){throw Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(e,t){var n;return 1===e.type?q.set.call(this,e,t,void 0,e.proxy):(void 0!==x(e.original,t)||t in e.original?(U(e),B(e),e.assignedMap.set(t,!1)):(e.assignedMap=null!=(n=e.assignedMap)?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function z(e){let{original:t,parentDraft:n,key:i,finalities:s,options:r}=e,o=v(t),a={type:o,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:s,options:r,setMap:3===o?new Map(t.entries()):void 0};(i||"key"in e)&&(a.key=i);let{proxy:l,revoke:c}=Proxy.revocable(1===o?Object.assign([],a):a,q);if(s.revoke.push(c),N.add(l),a.proxy=l,n)n.finalities.draft.push((e,t)=>{var s,r;let o=g(l),a=3===n.type?n.setMap:n.copy,c=w(a,i),h=g(c);if(h){let r=h.original;h.operated&&(r=y(c)),O(h),L(h,$,e,t),n.options.enableAutoFreeze&&(n.options.updatedValues=null!=(s=n.options.updatedValues)?s:new WeakMap,n.options.updatedValues.set(r,h.original)),b(a,i,r)}null==(r=o.callbacks)||r.forEach(n=>{n(e,t)})});else{let e=g(l);e.finalities.draft.push((t,n)=>{O(e),L(e,$,t,n)})}return l}function W(e){let{rootDraft:t,value:n,useRawReturn:s=!1,isRoot:r=!0}=e;T(n,(n,i,s)=>{let r=g(i);if(r&&t&&r.finalities===t.finalities){e.isContainDraft=!0;let t=r.original;if(s instanceof Set){let e=Array.from(s);s.clear(),e.forEach(e=>s.add(n===e?t:e))}else b(s,n,t)}else"object"==typeof i&&null!==i&&(e.value=i,e.isRoot=!1,W(e))}),r&&(e.isContainDraft||i.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),s&&i.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function Z(e){if(!g(e))throw Error(`current() is only used for Draft, parameter: ${e}`);return function e(t){var n;let i,s=g(t);if(!m(t,null==s?void 0:s.options))return t;let r=v(t);if(s&&!s.operated)return s.original;function o(){i=2===r?f(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):3===r?Array.from(s.setMap.values()):C(t,null==s?void 0:s.options)}if(s){s.finalized=!0;try{o()}finally{s.finalized=!1}}else i=t;if(T(i,(n,r)=>{if(s&&E(w(s.original,n),r))return;let a=e(r);a!==r&&(i===t&&o(),b(i,n,a))}),3===r){let e=null!=(n=null==s?void 0:s.original)?n:i;return d(e)?new Set(i):new(Object.getPrototypeOf(e)).constructor(i)}return i}(e)}c.createDraft=z;let V=(e=>{if(void 0!==e&&"[object Object]"!==Object.prototype.toString.call(e))throw Error(`Invalid options: ${String(e)}, 'options' should be an object.`);return function t(n,i,r){var a,c,h;let u;if("function"==typeof n&&"function"!=typeof i)return function(e,...s){return t(e,e=>n.call(this,e,...s),i)};let d=r;if("function"!=typeof i&&(d=i),void 0!==d&&"[object Object]"!==Object.prototype.toString.call(d))throw Error(`Invalid options: ${d}, 'options' should be an object.`);d=Object.assign(Object.assign({},e),d);let f=g(n)?Z(n):n,p=Array.isArray(d.mark)?(e,t)=>{for(let n of d.mark){if("function"!=typeof n)throw Error(`Invalid mark: ${n}, 'mark' should be a function.`);let i=n(e,t);if(i)return i}}:d.mark,y=null!=(a=d.enablePatches)&&a,w=null!=(c=d.strict)&&c,b={enableAutoFreeze:null!=(h=d.enableAutoFreeze)&&h,mark:p,strict:w,enablePatches:y};if(!m(f,b)&&"object"==typeof f&&null!==f)throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");let[x,k]=function(e,t){var n;let i,r,o={draft:[],revoke:[],handledSet:new WeakSet};t.enablePatches&&(i=[],r=[]);let a=(null==(n=t.mark)?void 0:n.call(t,e,l))!==l.mutable&&m(e,t)?z({original:e,parentDraft:null,finalities:o,options:t}):e;return[a,(e=[])=>{let[n,o,l]=function(e,t,n,i,r){var o;let a=g(e),l=null!=(o=null==a?void 0:a.original)?o:e,c=!!t.length;if(null==a?void 0:a.operated)for(;a.finalities.draft.length>0;)a.finalities.draft.pop()(n,i);let h=c?t[0]:a?a.operated?a.copy:a.original:e;return a&&S(a),r&&function e(t,n,i,s,r){{i=null!=i?i:new WeakMap,s=null!=s?s:[],r=null!=r?r:[];let e=i.has(t)?i.get(t):t;if(s.length>0){let t=s.indexOf(e);if(e&&"object"==typeof e&&-1!==t){if(s[0]===e)throw Error("Forbids circular reference");throw Error(`Forbids circular reference: ~/${r.slice(0,t).map((e,t)=>{if("symbol"==typeof e)return`[${e.toString()}]`;let n=s[t];return"object"==typeof e&&(n instanceof Map||n instanceof Set)?Array.from(n.keys()).indexOf(e):e}).join("/")}`)}s.push(e),r.push(n)}else s.push(e)}if(Object.isFrozen(t)||g(t)){s.pop(),r.pop();return}switch(v(t)){case 2:for(let[n,o]of t)e(n,n,i,s,r),e(o,n,i,s,r);t.set=t.clear=t.delete=I;break;case 3:for(let n of t)e(n,n,i,s,r);t.add=t.clear=t.delete=I;break;case 1:Object.freeze(t);let o=0;for(let n of t)e(n,o,i,s,r),o+=1;break;default:Object.freeze(t),Object.keys(t).forEach(n=>{e(t[n],n,i,s,r)})}s.pop(),r.pop()}(h,h,null==a?void 0:a.options.updatedValues),[h,n&&c?[{op:s.Replace,path:[],value:t[0]}]:n,i&&c?[{op:s.Replace,path:[],value:l}]:i]}(a,e,i,r,t.enableAutoFreeze);return t.enablePatches?[n,o,l]:n}]}(f,b);if("function"!=typeof i){if(!m(f,b))throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[x,k]}try{u=i(x)}catch(e){throw S(g(x)),e}let _=e=>{let t=g(x);if(!g(e)){if(void 0!==e&&!E(e,x)&&(null==t?void 0:t.operated))throw Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");let n=null==e?void 0:e[o];if(n){let i=n[0];return b.strict&&"object"==typeof e&&null!==e&&W({rootDraft:t,value:e,useRawReturn:!0}),k([i])}if(void 0!==e)return"object"==typeof e&&null!==e&&W({rootDraft:t,value:e}),k([e])}if(e===x||void 0===e)return k([]);let n=g(e);if(b===n.options){if(n.operated)throw Error("Cannot return a modified child draft.");return k([Z(e)])}return k([e])};return u instanceof Promise?u.then(_,e=>{throw S(g(x)),e}):_(u)}})();Object.prototype.constructor.toString()},92642:(e,t,n)=>{var i=n(49657);e.exports=function(e){return i(e)?void 0:e}},96631:(e,t,n)=>{"use strict";n.d(t,{I:()=>s});var i=n(36312),s=class extends i.xp{wsGetter;constructor(e,t,n){super(t,n),this.wsGetter=e}async createNewOutgoingConnection(e){this.log?.info(`establishing a new websocket to ${e}`,{clientId:this.clientId,connectedTo:e});let t=await this.wsGetter(e);await new Promise((e,n)=>t.readyState===t.OPEN?void e():t.readyState===t.CLOSING||t.readyState===t.CLOSED?void n(Error("ws is closing or closed")):void(t.onopen=()=>{e()},t.onclose=e=>{n(Error(e.reason))},t.onerror=e=>{n(Error(e.message))}));let n=new i.Yb(t);return this.log?.info(`raw websocket to ${e} ok`,{clientId:this.clientId,connectedTo:e,...n.loggingMetadata}),n}}}}]);
//# sourceMappingURL=8154-c4e5f591aec765f1.js.map